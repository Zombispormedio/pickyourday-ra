var app=angular.module("ar-toolkit",["ionic"]);angular.module("ar-toolkit").run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("ar-toolkit").directive("arView",["ARUtils","ARCamera","AR",function(e,n,t){return{restrict:"A",link:function(e,t,r){t[0];n.wait(function(){})}}}]),angular.module("ar-toolkit").factory("AR3D",function(){var e=function(e){function n(){o.needsUpdate=!0}var t=new THREE.Camera,r=new THREE.Scene,a=new THREE.PlaneGeometry(2,2,0),o=new THREE.Texture(e);o.minFilter=THREE.LinearFilter;var i=new THREE.MeshBasicMaterial({map:o,depthTest:!1,depthWrite:!1}),c=new THREE.Mesh(a,i);return r.add(c),{camera:t,scene:r,update:n}},n=function(){function e(e){t.add(e)}function n(e){t.remove(e)}var t=new THREE.Scene,r=new THREE.Camera;return{scene:t,camera:r,add:e,remove:n}},t=function(t,r,a){function o(){d.render(l.scene,l.camera),d.render(s.scene,s.camera)}function i(){l.update()}function c(e){s.add(e.model)}function u(e){s.remove(e.model)}var d=new THREE.WebGLRenderer({canvas:t});d.setSize(r.width,r.height),d.autoClear=!1;var l=new e(a),s=new n,w=new THREE.SpotLight(16777215);return w.position.set(0,0,9e3),w.lookAt(new THREE.Vector3(0,0,0)),s.scene.add(w),{add:c,remove:u,update:i,render:o,glCanvas:t}};return{create:t}}),angular.module("ar-toolkit").factory("ARCamera",["ARUtils",function(e){var n=document.getElementById("video");e.size(n);var t=function(e,n,t){var r=void 0;return navigator.getUserMedia?r=navigator.getUserMedia(e,n,t):navigator.webkitGetUserMedia&&(r=navigator.webkitGetUserMedia(e,n,t)),r},r=function(e){return function(t){var r=window.URL||window.webkitURL;n.src=r.createObjectURL(t),n.play(),e()}},a=function(e){console.log("An error occured! "+e)},o=function(e){t({video:!0,audio:!1},r(e),a)},i=function(){return{width:n.width,height:n.height}},c=function(e){e.drawImage(n,0,0)};return{wait:o,copyToContext:c,getDimensions:i}}]),angular.module("ar-toolkit").factory("ARDetector",function(){function e(){return{}}return{create:e}}),angular.module("ar-toolkit").factory("AR",["ARCamera","ARDetector","AR3D",function(e,n,t){var r,a,o,i=function(n){r=document.createElement("canvas");var i=e.getDimensions();r.width=i.width,r.height=i.height,a=r.getContext("2d"),o=t.create(n,i,r)},c=function(){e.copyToContext(a),r.changed=!0,o.update(),o.render(),window.requestAnimationFrame(c)};return{init:i,tick:c}}]),angular.module("ar-toolkit").factory("ARUtils",function(){return{size:function(e){e.width=window.innerWidth,e.height=window.innerHeight}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZy9ib290LmpzIiwiY29tcG9uZW50cy9kaXJlY3RpdmVzL2FyX3ZpZXdfZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfM2RfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2NhbWVyYV9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfZGV0ZWN0b3JfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2ZhY3RvcnkuanMiLCJjb21wb25lbnRzL2ZhY3Rvcmllcy9hcl91dGlsc19mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJydW4iLCIkaW9uaWNQbGF0Zm9ybSIsInJlYWR5Iiwid2luZG93IiwiY29yZG92YSIsInBsdWdpbnMiLCJLZXlib2FyZCIsImhpZGVLZXlib2FyZEFjY2Vzc29yeUJhciIsImRpc2FibGVTY3JvbGwiLCJTdGF0dXNCYXIiLCJzdHlsZURlZmF1bHQiLCJkaXJlY3RpdmUiLCJBUlV0aWxzIiwiQVJDYW1lcmEiLCJBUiIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwidEVsZW1lbnQiLCJhdHRycyIsIndhaXQiLCJmYWN0b3J5IiwiUmVhbGl0eSIsInNvdXJjZUNhbnZhcyIsInVwZGF0ZSIsInRleHR1cmUiLCJuZWVkc1VwZGF0ZSIsImNhbWVyYSIsIlRIUkVFIiwiQ2FtZXJhIiwic2NlbmUiLCJTY2VuZSIsImdlb21ldHJ5IiwiUGxhbmVHZW9tZXRyeSIsIlRleHR1cmUiLCJtaW5GaWx0ZXIiLCJMaW5lYXJGaWx0ZXIiLCJtYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwibWFwIiwiZGVwdGhUZXN0IiwiZGVwdGhXcml0ZSIsIm1lc2giLCJNZXNoIiwiYWRkIiwib2JqZWN0IiwicmVtb3ZlIiwiY3JlYXRlIiwiZ2xDYW52YXMiLCJkaW1lbnNpb25zIiwicmVuZGVyIiwicmVuZGVyZXIiLCJyZWFsaXR5IiwidmlydHVhbCIsIm1vZGVsIiwiV2ViR0xSZW5kZXJlciIsImNhbnZhcyIsInNldFNpemUiLCJ3aWR0aCIsImhlaWdodCIsImF1dG9DbGVhciIsImxpZ2h0IiwiU3BvdExpZ2h0IiwicG9zaXRpb24iLCJzZXQiLCJsb29rQXQiLCJWZWN0b3IzIiwidmlkZW8iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic2l6ZSIsImdldE1lZGlhQ2FwdHVyZSIsInQiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwicmVzdWx0IiwidW5kZWZpbmVkIiwibmF2aWdhdG9yIiwiZ2V0VXNlck1lZGlhIiwid2Via2l0R2V0VXNlck1lZGlhIiwib25TdWNjZXNzIiwiY2IiLCJzdHJlYW0iLCJ2ZW5kb3JVUkwiLCJVUkwiLCJ3ZWJraXRVUkwiLCJzcmMiLCJjcmVhdGVPYmplY3RVUkwiLCJwbGF5Iiwib25FcnJvciIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ3YWl0Q2FtZXJhIiwiY2FsbGJhY2siLCJhdWRpbyIsImdldERpbWVuc2lvbnMiLCJjb3B5VG9Db250ZXh0IiwiY29udGV4dCIsImRyYXdJbWFnZSIsIkFSRGV0ZWN0b3IiLCJBUjNEIiwidmlldyIsImluaXQiLCJjcmVhdGVFbGVtZW50IiwiY2FtZXJhRGltZW5zaW9ucyIsImdldENvbnRleHQiLCJ0aWNrIiwiY2hhbmdlZCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImVsZW0iLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsY0FBQSxTQ0FBRCxTQUFBQyxPQUFBLGNBQ0FDLEtBQUEsaUJBQUEsU0FBQUMsR0FDQUEsRUFBQUMsTUFBQSxXQUNBQyxPQUFBQyxTQUFBRCxPQUFBQyxRQUFBQyxRQUFBQyxXQUdBRixRQUFBQyxRQUFBQyxTQUFBQywwQkFBQSxHQUtBSCxRQUFBQyxRQUFBQyxTQUFBRSxlQUFBLElBRUFMLE9BQUFNLFdBQ0FBLFVBQUFDLG9CQ2RBWixRQUFBQyxP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QUNBdEMsTUFBQVMsRUFBQVQsTUFDQUMsT0FBQVEsRUFBQVIsU0FJQXNDLEVBQUEsU0FBQUMsR0FDQUEsRUFBQUMsVUFBQWhDLEVBQUEsRUFBQSxHQUdBLFFBQ0EvQyxLQUFBeUUsRUFDQUksY0FBQUEsRUFDQUQsY0FBQUEsTUNsREFsRyxRQUFBQyxPQUFBLGNBQ0FzQixRQUFBLGFBQUEsV0FFQSxRQUFBMEIsS0FDQSxTQUdBLE9BQ0FBLE9BQUFBLEtDUkFqRCxRQUFBQyxPQUFBLGNBQ0FzQixRQUFBLE1BQUEsV0FBQSxhQUFBLE9BQUEsU0FBQVIsRUFBQXVGLEVBQUFDLEdBRUEsR0FBQTdDLEdBQUEwQyxFQUFBSSxFQUNBQyxFQUFBLFNBQUF2RCxHQUVBUSxFQUFBWSxTQUFBb0MsY0FBQSxTQUNBLElBQUFDLEdBQUE1RixFQUFBbUYsZUFDQXhDLEdBQUFFLE1BQUErQyxFQUFBL0MsTUFDQUYsRUFBQUcsT0FBQThDLEVBQUE5QyxPQUVBdUMsRUFBQTFDLEVBQUFrRCxXQUFBLE1BSUFKLEVBQUFELEVBQUF0RCxPQUFBQyxFQUFBeUQsRUFBQWpELElBSUFtRCxFQUFBLFdBQ0E5RixFQUFBb0YsY0FBQUMsR0FDQTFDLEVBQUFvRCxTQUFBLEVBRUFOLEVBQUE5RSxTQUNBOEUsRUFBQXBELFNBR0EvQyxPQUFBMEcsc0JBQUFGLEdBR0EsUUFDQUosS0FBQUEsRUFDQUksS0FBQUEsTUNoQ0E3RyxRQUFBQyxPQUFBLGNBQ0FzQixRQUFBLFVBQUEsV0FFQSxPQUNBaUQsS0FBQSxTQUFBd0MsR0FDQUEsRUFBQXBELE1BQUF2RCxPQUFBNEcsV0FDQUQsRUFBQW5ELE9BQUF4RCxPQUFBNkciLCJmaWxlIjoicGlja3lvdXJkYXkubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcD1hbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcsIFsnaW9uaWMnXSlcblxuXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbi5ydW4oZnVuY3Rpb24oJGlvbmljUGxhdGZvcm0pIHtcclxuICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgIGlmKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcclxuICAgICAgLy8gSGlkZSB0aGUgYWNjZXNzb3J5IGJhciBieSBkZWZhdWx0IChyZW1vdmUgdGhpcyB0byBzaG93IHRoZSBhY2Nlc3NvcnkgYmFyIGFib3ZlIHRoZSBrZXlib2FyZFxyXG4gICAgICAvLyBmb3IgZm9ybSBpbnB1dHMpXHJcbiAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5oaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBEb24ndCByZW1vdmUgdGhpcyBsaW5lIHVubGVzcyB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuIEl0IHN0b3BzIHRoZSB2aWV3cG9ydFxyXG4gICAgICAvLyBmcm9tIHNuYXBwaW5nIHdoZW4gdGV4dCBpbnB1dHMgYXJlIGZvY3VzZWQuIElvbmljIGhhbmRsZXMgdGhpcyBpbnRlcm5hbGx5IGZvclxyXG4gICAgICAvLyBhIG11Y2ggbmljZXIga2V5Ym9hcmQgZXhwZXJpZW5jZS5cclxuICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmRpc2FibGVTY3JvbGwodHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBpZih3aW5kb3cuU3RhdHVzQmFyKSB7XHJcbiAgICAgIFN0YXR1c0Jhci5zdHlsZURlZmF1bHQoKTtcclxuICAgIH1cclxuICB9KTtcclxuICAgIFxyXG4gICAgXHJcbn0pIiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmRpcmVjdGl2ZSgnYXJWaWV3JywgZnVuY3Rpb24oQVJVdGlscywgQVJDYW1lcmEsIEFSKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgIGxpbms6ZnVuY3Rpb24oc2NvcGUsIHRFbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgIHZhciBlbGVtPXRFbGVtZW50WzBdO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgQVJDYW1lcmEud2FpdChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgLypBUi5pbml0KGVsZW0pO1xyXG4gICAgICAgICAgICAgICAgQVIudGljaygpOyovXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUjNEJywgZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHZhciBSZWFsaXR5PWZ1bmN0aW9uKHNvdXJjZUNhbnZhcyl7XHJcblxyXG4gICAgICAgIHZhciBjYW1lcmE9IG5ldyBUSFJFRS5DYW1lcmEoKTtcclxuICAgICAgICB2YXIgc2NlbmU9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICAgICAgICB2YXIgZ2VvbWV0cnk9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDIsMiwwKTtcclxuICAgICAgICB2YXIgdGV4dHVyZT1uZXcgVEhSRUUuVGV4dHVyZShzb3VyY2VDYW52YXMpO1xyXG4gICAgICAgIHRleHR1cmUubWluRmlsdGVyID0gVEhSRUUuTGluZWFyRmlsdGVyO1xyXG4gICAgICAgIHZhciBtYXRlcmlhbD0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOnRleHR1cmUsXHJcbiAgICAgICAgICAgIGRlcHRoVGVzdDpmYWxzZSxcclxuICAgICAgICAgICAgZGVwdGhXcml0ZTpmYWxzZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgbWVzaD0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsKTtcclxuICAgICAgICBzY2VuZS5hZGQobWVzaCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSgpe1xyXG4gICAgICAgICAgICB0ZXh0dXJlLm5lZWRzVXBkYXRlPXRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjYW1lcmE6IGNhbWVyYSxcclxuICAgICAgICAgICAgc2NlbmU6IHNjZW5lLFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSwgXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgU2NlbmU9ZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgc2NlbmU9bmV3IFRIUkVFLlNjZW5lKCk7XHJcbiAgICAgICAgdmFyIGNhbWVyYT1uZXcgVEhSRUUuQ2FtZXJhKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZChvYmplY3Qpe1xyXG4gICAgICAgICAgICBzY2VuZS5hZGQob2JqZWN0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShvYmplY3Qpe1xyXG4gICAgICAgICAgICBzY2VuZS5yZW1vdmUob2JqZWN0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgc2NlbmU6c2NlbmUsXHJcbiAgICAgICAgICAgIGNhbWVyYTpjYW1lcmEsXHJcbiAgICAgICAgICAgIGFkZDphZGQsXHJcbiAgICAgICAgICAgIHJlbW92ZTpyZW1vdmVcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgdmFyIGNyZWF0ZT1mdW5jdGlvbihnbENhbnZhcywgZGltZW5zaW9ucywgc291cmNlQ2FudmFzKXtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlcmVyPW5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHtjYW52YXM6Z2xDYW52YXN9KTtcclxuICAgICAgICByZW5kZXJlci5zZXRTaXplKGRpbWVuc2lvbnMud2lkdGgsIGRpbWVuc2lvbnMuaGVpZ2h0KTtcclxuICAgICAgICByZW5kZXJlci5hdXRvQ2xlYXI9ZmFsc2U7XHJcblxyXG4gICAgICAgIHZhciByZWFsaXR5PSBuZXcgUmVhbGl0eShzb3VyY2VDYW52YXMpO1xyXG4gICAgICAgIHZhciB2aXJ0dWFsPSBuZXcgU2NlbmUoKTtcclxuXHJcbiAgICAgICAgdmFyIGxpZ2h0PW5ldyBUSFJFRS5TcG90TGlnaHQoMHhmZmZmZmYpO1xyXG4gICAgICAgIGxpZ2h0LnBvc2l0aW9uLnNldCgwLDAsOTAwMCk7XHJcbiAgICAgICAgbGlnaHQubG9va0F0KG5ldyBUSFJFRS5WZWN0b3IzKDAsMCwwKSk7XHJcbiAgICAgICAgdmlydHVhbC5zY2VuZS5hZGQobGlnaHQpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW5kZXIoKXtcclxuICAgICAgICAgICAgcmVuZGVyZXIucmVuZGVyKHJlYWxpdHkuc2NlbmUsIHJlYWxpdHkuY2FtZXJhKTtcclxuICAgICAgICAgICAgcmVuZGVyZXIucmVuZGVyKHZpcnR1YWwuc2NlbmUsIHZpcnR1YWwuY2FtZXJhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSgpe1xyXG4gICAgICAgICAgICByZWFsaXR5LnVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkKG9iamVjdCl7XHJcbiAgICAgICAgICAgIHZpcnR1YWwuYWRkKG9iamVjdC5tb2RlbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUob2JqZWN0KXtcclxuICAgICAgICAgICAgdmlydHVhbC5yZW1vdmUob2JqZWN0Lm1vZGVsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFkZDogYWRkLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHJlbmRlcjogcmVuZGVyLFxyXG4gICAgICAgICAgICBnbENhbnZhczogZ2xDYW52YXNcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgY3JlYXRlOmNyZWF0ZVxyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSQ2FtZXJhJywgZnVuY3Rpb24oIEFSVXRpbHMpIHtcclxuXHJcbiAgICB2YXIgdmlkZW89IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlbycpO1xyXG4gICAgQVJVdGlscy5zaXplKHZpZGVvKTtcclxuXHJcbiAgICB2YXIgZ2V0TWVkaWFDYXB0dXJlID0gZnVuY3Rpb24odCwgb25zdWNjZXNzLCBvbmVycm9yKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLmdldFVzZXJNZWRpYSkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhKHQsIG9uc3VjY2Vzcywgb25lcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIGlmIChuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEodCwgb25zdWNjZXNzLCBvbmVycm9yKTtcclxuICAgICAgICB9IFxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBvblN1Y2Nlc3M9ZnVuY3Rpb24oY2Ipe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzdHJlYW0pe1xyXG4gICAgICAgICAgICB2YXIgdmVuZG9yVVJMID0gd2luZG93LlVSTCB8fCB3aW5kb3cud2Via2l0VVJMO1xyXG4gICAgICAgICAgICB2aWRlby5zcmMgPSB2ZW5kb3JVUkwuY3JlYXRlT2JqZWN0VVJMKHN0cmVhbSk7XHJcbiAgICAgICAgICAgIHZpZGVvLnBsYXkoKTtcclxuICAgICAgICAgICAgY2IoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgdmFyIG9uRXJyb3I9ZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkFuIGVycm9yIG9jY3VyZWQhIFwiICsgZXJyKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIHdhaXRDYW1lcmE9ZnVuY3Rpb24oY2FsbGJhY2spe1xyXG5cclxuICAgICAgICBnZXRNZWRpYUNhcHR1cmUoe3ZpZGVvOiB0cnVlLGF1ZGlvOiBmYWxzZX0sIG9uU3VjY2VzcyhjYWxsYmFjayksIG9uRXJyb3IpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YXIgZ2V0RGltZW5zaW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOnZpZGVvLndpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQ6dmlkZW8uaGVpZ2h0XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhciBjb3B5VG9Db250ZXh0PWZ1bmN0aW9uKGNvbnRleHQpe1xyXG4gICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKHZpZGVvLCAwLDApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgd2FpdDp3YWl0Q2FtZXJhLFxyXG4gICAgICAgIGNvcHlUb0NvbnRleHQ6Y29weVRvQ29udGV4dCxcclxuICAgICAgICBnZXREaW1lbnNpb25zOmdldERpbWVuc2lvbnNcclxuICAgIH1cclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUkRldGVjdG9yJywgZnVuY3Rpb24oKSB7XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGNyZWF0ZSgpe1xyXG4gICAgICAgIHJldHVybiB7fTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjcmVhdGU6Y3JlYXRlXHJcbiAgICB9XHJcbiAgICBcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSJywgZnVuY3Rpb24oQVJDYW1lcmEsIEFSRGV0ZWN0b3IsIEFSM0QpIHtcclxuXHJcbiAgICB2YXIgY2FudmFzLCBjb250ZXh0LCBkZXRlY3RvciwgdmlldztcclxuICAgIHZhciBpbml0PWZ1bmN0aW9uKGdsQ2FudmFzKXtcclxuXHJcbiAgICAgICAgY2FudmFzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgdmFyIGNhbWVyYURpbWVuc2lvbnM9QVJDYW1lcmEuZ2V0RGltZW5zaW9ucygpO1xyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IGNhbWVyYURpbWVuc2lvbnMud2lkdGg7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGNhbWVyYURpbWVuc2lvbnMuaGVpZ2h0O1xyXG5cclxuICAgICAgICBjb250ZXh0PWNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9kZXRlY3Rvcj1BUkRldGVjdG9yLmNyZWF0ZShjYW52YXMpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZpZXc9QVIzRC5jcmVhdGUoZ2xDYW52YXMsIGNhbWVyYURpbWVuc2lvbnMsIGNhbnZhcyk7XHJcblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICB2YXIgdGljaz1mdW5jdGlvbigpe1xyXG4gICAgICAgIEFSQ2FtZXJhLmNvcHlUb0NvbnRleHQoY29udGV4dCk7XHJcbiAgICAgICAgY2FudmFzLmNoYW5nZWQ9dHJ1ZTtcclxuICAgICAgICBcclxuICAgICAgICB2aWV3LnVwZGF0ZSgpO1xyXG4gICAgICAgIHZpZXcucmVuZGVyKCk7XHJcbiAgICAgICAgXHJcbiAgICBcclxuICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGluaXQ6aW5pdCxcclxuICAgICAgICB0aWNrOnRpY2tcclxuICAgIH1cclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUlV0aWxzJywgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzaXplOmZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICAgICAgICBlbGVtLndpZHRoPXdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICBlbGVtLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTsiXX0=
