var app=angular.module("ar-toolkit",["ionic"]);angular.module("ar-toolkit").run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("ar-toolkit").directive("arView",["ARUtils","ARCamera","AR","$ionicPlatform",function(e,t,r,n){return{restrict:"A",link:function(a,o,i){var c=o[0];n.ready(function(){e.size(c),e.setVideoSize(),t.wait(function(){r.init(c),r.tick()})})}}}]),angular.module("ar-toolkit").factory("AR3D",function(){var e=function(e){function t(){o.needsUpdate=!0}var r=new THREE.Camera,n=new THREE.Scene,a=new THREE.PlaneGeometry(2,2,0),o=new THREE.Texture(e);o.generateMipmaps=!1,o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.wrapS=o.wrapT=THREE.ClampToEdgeWrapping;var i=new THREE.MeshBasicMaterial({map:o,depthTest:!1,depthWrite:!1}),c=new THREE.Mesh(a,i);return n.add(c),{camera:r,scene:n,update:t}},t=function(){function e(e){n.add(e)}function t(e){n.remove(e)}function r(e){a.projectionMatrix.setFromArray(e)}var n=new THREE.Scene,a=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);return{scene:n,camera:a,add:e,remove:t,setProjectionMatrix:r}},r=function(r,n,a){function o(){l.render(m.scene,m.camera),v.rotation.x+=.1,v.rotation.y+=.1,l.render(s.scene,s.camera)}function i(){m.update()}function c(e){s.add(e.model)}function u(e){}function d(e){s.remove(e.model)}var l=new THREE.WebGLRenderer({canvas:r});l.setSize(n.width,n.height),l.autoClear=!1;var m=new e(a),s=new t,f=new THREE.SpotLight(16777215);f.position.set(0,0,9e3),f.lookAt(new THREE.Vector3(0,0,0)),s.scene.add(f);var w=new THREE.BoxGeometry(1,1,1),g=new THREE.MeshBasicMaterial({color:65280}),v=new THREE.Mesh(w,g);return s.add(v),v.position.z=-5,{add:c,remove:d,update:i,render:o,glCanvas:r,setCameraMatrix:u}};return{create:r}}),angular.module("ar-toolkit").factory("ARCamera",["ARUtils","$ionicPlatform",function(e,t){var r=document.getElementById("video"),n=function(e,t,r){var n=void 0;return navigator.getUserMedia?n=navigator.getUserMedia(e,t,r):navigator.webkitGetUserMedia&&(n=navigator.webkitGetUserMedia(e,t,r)),n},a=function(e){return function(t){var n=window.URL||window.webkitURL;r.src=n.createObjectURL(t),r.play(),e()}},o=function(e){console.log("An error occured! "+e)},i=function(e){n({video:!0,audio:!1},a(e),o)},c=function(){return{width:r.width,height:r.height}},u=function(e){e.drawImage(r,0,0)};return{wait:i,copyToContext:u,getDimensions:c}}]),angular.module("ar-toolkit").factory("ARDetector",function(){function e(e){var t=new NyARRgbRaster_Canvas2D(e),r=new FLARParam(e.width,e.height),n=new FLARMultiIdMarkerDetector(r,120);n.setContinueMode(!0);var a=function(e){var t=n.getIdMarkerData(e);if(t.packetLength>4)return-1;for(var r=0,a=0;a<t.packetLength;a++)r=r<<8|t.getPacketData(a);return r},o=function(e){var t=new NyARTransMatResult;n.getTransformMatrix(e,t);var r=new Float32Array(16);return r[0]=t.m00,r[1]=-t.m10,r[2]=t.m20,r[3]=0,r[4]=t.m01,r[5]=-t.m11,r[6]=t.m21,r[7]=0,r[8]=-t.m02,r[9]=t.m12,r[10]=-t.m22,r[11]=0,r[12]=t.m03,r[13]=-t.m13,r[14]=t.m23,r[15]=1,r},i=function(e,t){var n=new Float32Array(16);return r.copyCameraMatrix(n,e,t),n},c=1,u=function(e,t){return{id:e,matrix:t,age:c}},d={},l=function(e,r,i){for(var l=n.detectMarkerLite(t,70),m=0;l>m;m++){var s=a(m),f=d[s];void 0===f?(f=u(s,o(m)),d[s]=f,e(f)):(f.matrix=o(m),f.age=c,r(f))}for(var s in d){var f=d[s];f&&0==f.age--&&(i(f),delete d[s])}};return{detect:l,getCameraMatrix:i}}return{create:e}}),angular.module("ar-toolkit").factory("AR",["ARCamera","ARDetector","AR3D","ARMarker",function(e,t,r,n){var a,o,i,c,u=function(n){a=document.createElement("canvas");var u=e.getDimensions();a.width=u.width,a.height=u.height,o=a.getContext("2d"),i=t.create(a),c=r.create(n,u,a),c.setCameraMatrix(i.getCameraMatrix(10,1e3))},d=function(){e.copyToContext(o),a.changed=!0,c.update(),c.render(),window.requestAnimationFrame(d)};return{init:u,tick:d}}]),angular.module("ar-toolkit").factory("ARMarker",["ARObject",function(e){var t={16:e.create({color:13369344}),32:e.create({color:52224}),64:e.create({color:204})},r=function(e){return function(r){console.log("Created"),console.log(r.id);var n=t[r.id];n.transform(r.matrix),e.add(n)}},n=function(e){return function(e){console.log("update"),console.log(e.id);var r=t[e.id];r.transform(e.matrix)}},a=function(e){return function(r){console.log("remove"),console.log(r.id);var n=t[r.id];e.remove(n)}};return{onCreate:r,onUpdate:n,onDestroy:a}}]),angular.module("ar-toolkit").factory("ARObject",function(){function e(){var e=new THREE.Object3D;return e.matrixAutoUpdate=!1,e}function t(e){var t=new THREE.CubeGeometry(100,100,100),r=new THREE.MeshPhongMaterial({color:e,side:THREE.DoubleSide}),n=new THREE.Mesh(t,r);return n.position.z=-50,n}function r(r){function n(e){a.transformFromArray(e)}var a=e(),o=t(r.color);return a.add(o),{transform:n,model:a}}return{create:r}}),angular.module("ar-toolkit").factory("ARUtils",["$ionicPlatform",function(e){var t=function(e){e.width=window.innerWidth,e.height=window.innerHeight};return{size:t,setVideoSize:function(){t(document.getElementById("video"))}}}]),THREE.Matrix4.prototype.setFromArray=function(e){return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},THREE.Object3D.prototype.transformFromArray=function(e){this.matrix.setFromArray(e),this.matrixWorldNeedsUpdate=!0};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZy9ib290LmpzIiwiY29tcG9uZW50cy9kaXJlY3RpdmVzL2FyX3ZpZXdfZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfM2RfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2NhbWVyYV9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfZGV0ZWN0b3JfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2ZhY3RvcnkuanMiLCJjb21wb25lbnRzL2ZhY3Rvcmllcy9hcl9tYXJrZXJfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX29iamVjdF9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfdXRpbHNfZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwicnVuIiwiJGlvbmljUGxhdGZvcm0iLCJyZWFkeSIsIndpbmRvdyIsImNvcmRvdmEiLCJwbHVnaW5zIiwiS2V5Ym9hcmQiLCJoaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIiLCJkaXNhYmxlU2Nyb2xsIiwiU3RhdHVzQmFyIiwic3R5bGVEZWZhdWx0IiwiZGlyZWN0aXZlIiwiQVJVdGlscyIsIkFSQ2FtZXJhIiwiQVIiLCJyZXN0cmljdCIsImxpbmsiLCJzY29wZSIsInRFbGVtZW50IiwiYXR0cnMiLCJlbGVtIiwic2l6ZSIsInNldFZpZGVvU2l6ZSIsIndhaXQiLCJpbml0IiwidGljayIsImZhY3RvcnkiLCJSZWFsaXR5Iiwic291cmNlQ2FudmFzIiwidXBkYXRlIiwidGV4dHVyZSIsIm5lZWRzVXBkYXRlIiwiY2FtZXJhIiwiVEhSRUUiLCJDYW1lcmEiLCJzY2VuZSIsIlNjZW5lIiwiZ2VvbWV0cnkiLCJQbGFuZUdlb21ldHJ5IiwiVGV4dHVyZSIsImdlbmVyYXRlTWlwbWFwcyIsIm1pbkZpbHRlciIsIk5lYXJlc3RGaWx0ZXIiLCJtYWdGaWx0ZXIiLCJ3cmFwUyIsIndyYXBUIiwiQ2xhbXBUb0VkZ2VXcmFwcGluZyIsIm1hdGVyaWFsIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJtYXAiLCJkZXB0aFRlc3QiLCJkZXB0aFdyaXRlIiwibWVzaCIsIk1lc2giLCJhZGQiLCJvYmplY3QiLCJyZW1vdmUiLCJzZXRQcm9qZWN0aW9uTWF0cml4IiwibWF0cml4IiwicHJvamVjdGlvbk1hdHJpeCIsInNldEZyb21BcnJheSIsIlBlcnNwZWN0aXZlQ2FtZXJhIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiY3JlYXRlIiwiZ2xDYW52YXMiLCJkaW1lbnNpb25zIiwicmVuZGVyIiwicmVuZGVyZXIiLCJyZWFsaXR5IiwiY3ViZSIsInJvdGF0aW9uIiwieCIsInkiLCJ2aXJ0dWFsIiwibW9kZWwiLCJzZXRDYW1lcmFNYXRyaXgiLCJXZWJHTFJlbmRlcmVyIiwiY2FudmFzIiwic2V0U2l6ZSIsIndpZHRoIiwiaGVpZ2h0IiwiYXV0b0NsZWFyIiwibGlnaHQiLCJTcG90TGlnaHQiLCJwb3NpdGlvbiIsInNldCIsImxvb2tBdCIsIlZlY3RvcjMiLCJCb3hHZW9tZXRyeSIsImNvbG9yIiwieiIsInZpZGVvIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldE1lZGlhQ2FwdHVyZSIsInQiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwicmVzdWx0IiwidW5kZWZpbmVkIiwibmF2aWdhdG9yIiwiZ2V0VXNlck1lZGlhIiwid2Via2l0R2V0VXNlck1lZGlhIiwib25TdWNjZXNzIiwiY2IiLCJzdHJlYW0iLCJ2ZW5kb3JVUkwiLCJVUkwiLCJ3ZWJraXRVUkwiLCJzcmMiLCJjcmVhdGVPYmplY3RVUkwiLCJwbGF5Iiwib25FcnJvciIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ3YWl0Q2FtZXJhIiwiY2FsbGJhY2siLCJhdWRpbyIsImdldERpbWVuc2lvbnMiLCJjb3B5VG9Db250ZXh0IiwiY29udGV4dCIsImRyYXdJbWFnZSIsIkpTQVJSYXN0ZXIiLCJOeUFSUmdiUmFzdGVyX0NhbnZhczJEIiwiSlNBUlBhcmFtZXRlcnMiLCJGTEFSUGFyYW0iLCJKU0FSRGV0ZWN0b3IiLCJGTEFSTXVsdGlJZE1hcmtlckRldGVjdG9yIiwic2V0Q29udGludWVNb2RlIiwiZ2V0TWFya2VyTnVtYmVyIiwiaWR4IiwiZGF0YSIsImdldElkTWFya2VyRGF0YSIsInBhY2tldExlbmd0aCIsImkiLCJnZXRQYWNrZXREYXRhIiwiZ2V0VHJhbnNmb3JtTWF0cml4IiwibWF0IiwiTnlBUlRyYW5zTWF0UmVzdWx0IiwiY20iLCJGbG9hdDMyQXJyYXkiLCJtMDAiLCJtMTAiLCJtMjAiLCJtMDEiLCJtMTEiLCJtMjEiLCJtMDIiLCJtMTIiLCJtMjIiLCJtMDMiLCJtMTMiLCJtMjMiLCJnZXRDYW1lcmFNYXRyaXgiLCJ6TmVhciIsInpGYXIiLCJjb3B5Q2FtZXJhTWF0cml4IiwicGVyc2lzdFRpbWUiLCJuZXdNYXJrZXIiLCJpZCIsImFnZSIsIm1hcmtlcnMiLCJkZXRlY3QiLCJvbkNyZWF0ZSIsIm9uVXBkYXRlIiwib25EZXN0cm95IiwibWFya2VyQ291bnQiLCJkZXRlY3RNYXJrZXJMaXRlIiwiaW5kZXgiLCJtYXJrZXIiLCJBUkRldGVjdG9yIiwiQVIzRCIsIkFSTWFya2VyIiwiZGV0ZWN0b3IiLCJ2aWV3IiwiY3JlYXRlRWxlbWVudCIsImNhbWVyYURpbWVuc2lvbnMiLCJnZXRDb250ZXh0IiwiY2hhbmdlZCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIkFST2JqZWN0Iiwib2JqZWN0cyIsMTYsMzIsNjQsInRyYW5zZm9ybSIsImNyZWF0ZUNvbnRhaW5lciIsIk9iamVjdDNEIiwibWF0cml4QXV0b1VwZGF0ZSIsImNyZWF0ZU1hcmtlck1lc2giLCJDdWJlR2VvbWV0cnkiLCJNZXNoUGhvbmdNYXRlcmlhbCIsInNpZGUiLCJEb3VibGVTaWRlIiwiY3JlYXRlTWFya2VyT2JqZWN0IiwicGFyYW1zIiwibW9kZWxDb250YWluZXIiLCJ0cmFuc2Zvcm1Gcm9tQXJyYXkiLCJtb2RlbE1lc2gi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b3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwPWFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JywgWydpb25pYyddKVxuXG5cbiAgICAgICAgICBcblx0XHQiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbi5ydW4oZnVuY3Rpb24oJGlvbmljUGxhdGZvcm0pIHtcclxuICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgIGlmKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcclxuICAgICAgLy8gSGlkZSB0aGUgYWNjZXNzb3J5IGJhciBieSBkZWZhdWx0IChyZW1vdmUgdGhpcyB0byBzaG93IHRoZSBhY2Nlc3NvcnkgYmFyIGFib3ZlIHRoZSBrZXlib2FyZFxyXG4gICAgICAvLyBmb3IgZm9ybSBpbnB1dHMpXHJcbiAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5oaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBEb24ndCByZW1vdmUgdGhpcyBsaW5lIHVubGVzcyB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuIEl0IHN0b3BzIHRoZSB2aWV3cG9ydFxyXG4gICAgICAvLyBmcm9tIHNuYXBwaW5nIHdoZW4gdGV4dCBpbnB1dHMgYXJlIGZvY3VzZWQuIElvbmljIGhhbmRsZXMgdGhpcyBpbnRlcm5hbGx5IGZvclxyXG4gICAgICAvLyBhIG11Y2ggbmljZXIga2V5Ym9hcmQgZXhwZXJpZW5jZS5cclxuICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmRpc2FibGVTY3JvbGwodHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBpZih3aW5kb3cuU3RhdHVzQmFyKSB7XHJcbiAgICAgIFN0YXR1c0Jhci5zdHlsZURlZmF1bHQoKTtcclxuICAgIH1cclxuICAgIFxyXG4gIH0pO1xyXG4gICAgXHJcbiAgICBcclxufSkiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZGlyZWN0aXZlKCdhclZpZXcnLCBmdW5jdGlvbihBUlV0aWxzLCBBUkNhbWVyYSwgQVIsICRpb25pY1BsYXRmb3JtKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgIGxpbms6ZnVuY3Rpb24oc2NvcGUsIHRFbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgIHZhciBlbGVtPXRFbGVtZW50WzBdO1xyXG4gICAgICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIEFSVXRpbHMuc2l6ZShlbGVtKTtcclxuICAgICAgICAgICAgICAgIEFSVXRpbHMuIHNldFZpZGVvU2l6ZSgpO1xyXG4gICAgICAgICAgICAgICAgQVJDYW1lcmEud2FpdChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIEFSLmluaXQoZWxlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgQVIudGljaygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUjNEJywgZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHZhciBSZWFsaXR5PWZ1bmN0aW9uKHNvdXJjZUNhbnZhcyl7XHJcblxyXG4gICAgICAgIHZhciBjYW1lcmE9IG5ldyBUSFJFRS5DYW1lcmEoKTtcclxuICAgICAgICB2YXIgc2NlbmU9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICAgICAgICB2YXIgZ2VvbWV0cnk9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDIsMiwwKTtcclxuICAgICAgICB2YXIgdGV4dHVyZT1uZXcgVEhSRUUuVGV4dHVyZShzb3VyY2VDYW52YXMpO1xyXG4gICAgICAgIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7XHJcbiAgICAgICAgdGV4dHVyZS5taW5GaWx0ZXIgPSBUSFJFRS5OZWFyZXN0RmlsdGVyO1xyXG4gICAgICAgIHRleHR1cmUubWFnRmlsdGVyID0gVEhSRUUuTmVhcmVzdEZpbHRlcjtcclxuICAgICAgICB0ZXh0dXJlLndyYXBTID0gdGV4dHVyZS53cmFwVCA9VEhSRUUuQ2xhbXBUb0VkZ2VXcmFwcGluZztcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgdmFyIG1hdGVyaWFsPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6dGV4dHVyZSxcclxuICAgICAgICAgICAgZGVwdGhUZXN0OmZhbHNlLFxyXG4gICAgICAgICAgICBkZXB0aFdyaXRlOmZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBtZXNoPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpO1xyXG4gICAgICAgIHNjZW5lLmFkZChtZXNoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCl7XHJcbiAgICAgICAgICAgIHRleHR1cmUubmVlZHNVcGRhdGU9dHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNhbWVyYTogY2FtZXJhLFxyXG4gICAgICAgICAgICBzY2VuZTogc2NlbmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLCBcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBTY2VuZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG4gICAgICAgIHZhciBjYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoIDc1LCB3aW5kb3cuaW5uZXJXaWR0aC93aW5kb3cuaW5uZXJIZWlnaHQsIDAuMSwgMTAwMCApO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGQob2JqZWN0KSB7XHJcblxyXG4gICAgICAgICAgICBzY2VuZS5hZGQob2JqZWN0KTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKG9iamVjdCkge1xyXG4gICAgICAgICAgICBzY2VuZS5yZW1vdmUob2JqZWN0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFByb2plY3Rpb25NYXRyaXgobWF0cml4KSB7XHJcbiAgICAgICAgICAgIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LnNldEZyb21BcnJheSggbWF0cml4ICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzY2VuZTpzY2VuZSxcclxuICAgICAgICAgICAgY2FtZXJhOmNhbWVyYSxcclxuICAgICAgICAgICAgYWRkOmFkZCxcclxuICAgICAgICAgICAgcmVtb3ZlOnJlbW92ZSxcclxuICAgICAgICAgICAgc2V0UHJvamVjdGlvbk1hdHJpeDpzZXRQcm9qZWN0aW9uTWF0cml4LFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIGNyZWF0ZT1mdW5jdGlvbihnbENhbnZhcywgZGltZW5zaW9ucywgc291cmNlQ2FudmFzKXtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlcmVyPW5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHtjYW52YXM6Z2xDYW52YXN9KTtcclxuICAgICAgICByZW5kZXJlci5zZXRTaXplKGRpbWVuc2lvbnMud2lkdGgsIGRpbWVuc2lvbnMuaGVpZ2h0KTtcclxuICAgICAgICByZW5kZXJlci5hdXRvQ2xlYXI9ZmFsc2U7XHJcblxyXG4gICAgICAgIHZhciByZWFsaXR5PSBuZXcgUmVhbGl0eShzb3VyY2VDYW52YXMpO1xyXG4gICAgICAgIHZhciB2aXJ0dWFsPSBuZXcgU2NlbmUoKTtcclxuXHJcbiAgICAgICAgdmFyIGxpZ2h0PW5ldyBUSFJFRS5TcG90TGlnaHQoMHhmZmZmZmYpO1xyXG4gICAgICAgIGxpZ2h0LnBvc2l0aW9uLnNldCgwLDAsOTAwMCk7XHJcbiAgICAgICAgbGlnaHQubG9va0F0KG5ldyBUSFJFRS5WZWN0b3IzKDAsMCwwKSk7XHJcbiAgICAgICAgdmlydHVhbC5zY2VuZS5hZGQobGlnaHQpO1xyXG5cclxuXHJcblxyXG4gICAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMSwgMSwgMSApO1xyXG4gICAgICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHgwMGZmMDAgfSApO1xyXG4gICAgICAgIHZhciBjdWJlID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xyXG4gICAgICAgIHZpcnR1YWwuYWRkKCBjdWJlICk7XHJcblxyXG4gICAgICAgIGN1YmUucG9zaXRpb24uej0tNTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCl7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcihyZWFsaXR5LnNjZW5lLCByZWFsaXR5LmNhbWVyYSk7XHJcblxyXG5cclxuICAgICAgICAgICAgY3ViZS5yb3RhdGlvbi54ICs9IDAuMTtcclxuICAgICAgICAgICAgY3ViZS5yb3RhdGlvbi55ICs9IDAuMTtcclxuXHJcblxyXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIodmlydHVhbC5zY2VuZSwgdmlydHVhbC5jYW1lcmEpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSgpe1xyXG4gICAgICAgICAgICAgcmVhbGl0eS51cGRhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZChvYmplY3Qpe1xyXG4gICAgICAgICAgICAgIHZpcnR1YWwuYWRkKG9iamVjdC5tb2RlbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRDYW1lcmFNYXRyaXgoIG1hdHJpeCApIHtcclxuICAgICAgICAgICAgLy92aXJ0dWFsLnNldFByb2plY3Rpb25NYXRyaXgoIG1hdHJpeCApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKG9iamVjdCl7XHJcbiAgICAgICAgICAgICB2aXJ0dWFsLnJlbW92ZShvYmplY3QubW9kZWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYWRkOiBhZGQsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgcmVuZGVyOiByZW5kZXIsXHJcbiAgICAgICAgICAgIGdsQ2FudmFzOiBnbENhbnZhcyxcclxuICAgICAgICAgICAgc2V0Q2FtZXJhTWF0cml4OiBzZXRDYW1lcmFNYXRyaXgsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNyZWF0ZTpjcmVhdGVcclxuICAgIH1cclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUkNhbWVyYScsIGZ1bmN0aW9uKCBBUlV0aWxzLCAkaW9uaWNQbGF0Zm9ybSkge1xyXG5cclxuICAgIHZhciB2aWRlbz0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvJyk7XHJcbiBcclxuICAgIHZhciBnZXRNZWRpYUNhcHR1cmUgPSBmdW5jdGlvbih0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IG5hdmlnYXRvci5nZXRVc2VyTWVkaWEodCwgb25zdWNjZXNzLCBvbmVycm9yKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSh0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIG9uU3VjY2Vzcz1mdW5jdGlvbihjYil7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSl7XHJcbiAgICAgICAgICAgIHZhciB2ZW5kb3JVUkwgPSB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkw7XHJcbiAgICAgICAgICAgIHZpZGVvLnNyYyA9IHZlbmRvclVSTC5jcmVhdGVPYmplY3RVUkwoc3RyZWFtKTtcclxuICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xyXG4gICAgICAgICAgICBjYigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICB2YXIgb25FcnJvcj1mdW5jdGlvbihlcnIpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQW4gZXJyb3Igb2NjdXJlZCEgXCIgKyBlcnIpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2YXIgd2FpdENhbWVyYT1mdW5jdGlvbihjYWxsYmFjayl7XHJcblxyXG4gICAgICAgIGdldE1lZGlhQ2FwdHVyZSh7dmlkZW86IHRydWUsYXVkaW86IGZhbHNlfSwgb25TdWNjZXNzKGNhbGxiYWNrKSwgb25FcnJvcik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHZhciBnZXREaW1lbnNpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6dmlkZW8ud2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDp2aWRlby5oZWlnaHRcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGNvcHlUb0NvbnRleHQ9ZnVuY3Rpb24oY29udGV4dCl7XHJcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UodmlkZW8sIDAsMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB3YWl0OndhaXRDYW1lcmEsXHJcbiAgICAgICAgY29weVRvQ29udGV4dDpjb3B5VG9Db250ZXh0LFxyXG4gICAgICAgIGdldERpbWVuc2lvbnM6Z2V0RGltZW5zaW9uc1xyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSRGV0ZWN0b3InLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmVhdGUoc291cmNlQ2FudmFzKXtcclxuICAgICAgIHZhciBKU0FSUmFzdGVyID0gbmV3IE55QVJSZ2JSYXN0ZXJfQ2FudmFzMkQoc291cmNlQ2FudmFzKTtcclxuICAgICAgICB2YXIgSlNBUlBhcmFtZXRlcnMgPSBuZXcgRkxBUlBhcmFtKHNvdXJjZUNhbnZhcy53aWR0aCwgc291cmNlQ2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgdmFyIEpTQVJEZXRlY3RvciA9IG5ldyBGTEFSTXVsdGlJZE1hcmtlckRldGVjdG9yKEpTQVJQYXJhbWV0ZXJzLCAxMjApO1xyXG4gICAgICAgIEpTQVJEZXRlY3Rvci5zZXRDb250aW51ZU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIHZhciBnZXRNYXJrZXJOdW1iZXIgPSBmdW5jdGlvbihpZHgpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBKU0FSRGV0ZWN0b3IuZ2V0SWRNYXJrZXJEYXRhKGlkeCk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhLnBhY2tldExlbmd0aCA+IDQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciByZXN1bHQ9MDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLnBhY2tldExlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gKHJlc3VsdCA8PCA4KSB8IGRhdGEuZ2V0UGFja2V0RGF0YShpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBnZXRUcmFuc2Zvcm1NYXRyaXggPSBmdW5jdGlvbihpZHgpIHtcclxuICAgICAgICAgICAgdmFyIG1hdCA9IG5ldyBOeUFSVHJhbnNNYXRSZXN1bHQoKTtcclxuICAgICAgICAgICAgSlNBUkRldGVjdG9yLmdldFRyYW5zZm9ybU1hdHJpeChpZHgsIG1hdCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY20gPSBuZXcgRmxvYXQzMkFycmF5KDE2KTtcclxuICAgICAgICAgICAgY21bMF0gPSBtYXQubTAwO1xyXG4gICAgICAgICAgICBjbVsxXSA9IC1tYXQubTEwO1xyXG4gICAgICAgICAgICBjbVsyXSA9IG1hdC5tMjA7XHJcbiAgICAgICAgICAgIGNtWzNdID0gMDtcclxuICAgICAgICAgICAgY21bNF0gPSBtYXQubTAxO1xyXG4gICAgICAgICAgICBjbVs1XSA9IC1tYXQubTExO1xyXG4gICAgICAgICAgICBjbVs2XSA9IG1hdC5tMjE7XHJcbiAgICAgICAgICAgIGNtWzddID0gMDtcclxuICAgICAgICAgICAgY21bOF0gPSAtbWF0Lm0wMjtcclxuICAgICAgICAgICAgY21bOV0gPSBtYXQubTEyO1xyXG4gICAgICAgICAgICBjbVsxMF0gPSAtbWF0Lm0yMjtcclxuICAgICAgICAgICAgY21bMTFdID0gMDtcclxuICAgICAgICAgICAgY21bMTJdID0gbWF0Lm0wMztcclxuICAgICAgICAgICAgY21bMTNdID0gLW1hdC5tMTM7XHJcbiAgICAgICAgICAgIGNtWzE0XSA9IG1hdC5tMjM7XHJcbiAgICAgICAgICAgIGNtWzE1XSA9IDE7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY207XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZ2V0Q2FtZXJhTWF0cml4ID0gZnVuY3Rpb24oek5lYXIsIHpGYXIpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpO1xyXG4gICAgICAgICAgICBKU0FSUGFyYW1ldGVycy5jb3B5Q2FtZXJhTWF0cml4KHJlc3VsdCwgek5lYXIsIHpGYXIpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHBlcnNpc3RUaW1lID0gMTtcclxuICAgICAgICB2YXIgbmV3TWFya2VyID0gZnVuY3Rpb24oaWQsIG1hdHJpeCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgbWF0cml4OiBtYXRyaXgsXHJcbiAgICAgICAgICAgICAgICBhZ2U6IHBlcnNpc3RUaW1lLFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbWFya2VycyA9IHt9O1xyXG4gICAgICAgIHZhciBkZXRlY3QgPSBmdW5jdGlvbiggb25DcmVhdGUsIG9uVXBkYXRlLCBvbkRlc3Ryb3kgKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXJrZXJDb3VudCA9IEpTQVJEZXRlY3Rvci5kZXRlY3RNYXJrZXJMaXRlKEpTQVJSYXN0ZXIsIDcwKTsgXHJcbiAgICAgICAgICAgIGZvciggdmFyIGluZGV4ID0gMDsgaW5kZXggPCBtYXJrZXJDb3VudDsgaW5kZXgrKyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZCA9IGdldE1hcmtlck51bWJlcihpbmRleCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbWFya2Vyc1tpZF07XHJcbiAgICAgICAgICAgICAgICBpZiggbWFya2VyID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyID0gbmV3TWFya2VyKGlkLCBnZXRUcmFuc2Zvcm1NYXRyaXgoaW5kZXgpKTtcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzW2lkXSA9IG1hcmtlcjtcclxuICAgICAgICAgICAgICAgICAgICBvbkNyZWF0ZSggbWFya2VyICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXIubWF0cml4ID0gZ2V0VHJhbnNmb3JtTWF0cml4KGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXIuYWdlID0gcGVyc2lzdFRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgb25VcGRhdGUoIG1hcmtlciApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IoIHZhciBpZCBpbiBtYXJrZXJzICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNbaWRdO1xyXG4gICAgICAgICAgICAgICAgaWYoIG1hcmtlciApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiggbWFya2VyLmFnZS0tID09IDAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRGVzdHJveSggbWFya2VyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBtYXJrZXJzW2lkXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgIGRldGVjdDogZGV0ZWN0LFxyXG4gICAgICAgICAgICBnZXRDYW1lcmFNYXRyaXg6IGdldENhbWVyYU1hdHJpeFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjcmVhdGU6Y3JlYXRlXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVInLCBmdW5jdGlvbihBUkNhbWVyYSwgQVJEZXRlY3RvciwgQVIzRCwgQVJNYXJrZXIpIHtcclxuXHJcbiAgICB2YXIgY2FudmFzLCBjb250ZXh0LCBkZXRlY3RvciwgdmlldztcclxuICAgIHZhciBpbml0PWZ1bmN0aW9uKGdsQ2FudmFzKXtcclxuXHJcbiAgICAgICAgY2FudmFzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgdmFyIGNhbWVyYURpbWVuc2lvbnM9QVJDYW1lcmEuZ2V0RGltZW5zaW9ucygpO1xyXG4gIFxyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IGNhbWVyYURpbWVuc2lvbnMud2lkdGg7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGNhbWVyYURpbWVuc2lvbnMuaGVpZ2h0O1xyXG5cclxuICAgICAgICBjb250ZXh0PWNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4gICAgICAgIGRldGVjdG9yPUFSRGV0ZWN0b3IuY3JlYXRlKGNhbnZhcyk7XHJcblxyXG4gICAgICAgIHZpZXc9QVIzRC5jcmVhdGUoZ2xDYW52YXMsIGNhbWVyYURpbWVuc2lvbnMsIGNhbnZhcyk7XHJcblxyXG4gICAgICAgIHZpZXcuc2V0Q2FtZXJhTWF0cml4KCBkZXRlY3Rvci5nZXRDYW1lcmFNYXRyaXgoMTAsMTAwMCkgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRpY2s9ZnVuY3Rpb24oKXtcclxuICAgICAgICBBUkNhbWVyYS5jb3B5VG9Db250ZXh0KGNvbnRleHQpO1xyXG4gICAgICAgIGNhbnZhcy5jaGFuZ2VkPXRydWU7XHJcblxyXG4gICAgICAgLy8gZGV0ZWN0b3IuZGV0ZWN0KEFSTWFya2VyLm9uQ3JlYXRlKHZpZXcpLCBBUk1hcmtlci5vblVwZGF0ZSh2aWV3KSwgQVJNYXJrZXIub25EZXN0cm95KHZpZXcpKTtcclxuICAgICAgICBcclxuICAgICAgICB2aWV3LnVwZGF0ZSgpO1xyXG4gICAgICAgIHZpZXcucmVuZGVyKCk7XHJcblxyXG5cclxuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2spO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW5pdDppbml0LFxyXG4gICAgICAgIHRpY2s6dGlja1xyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSTWFya2VyJywgZnVuY3Rpb24oQVJPYmplY3QpIHtcclxuXHJcbiAgICB2YXIgb2JqZWN0cz17XHJcbiAgICAgICAgMTY6IEFST2JqZWN0LmNyZWF0ZSh7Y29sb3I6MHhDQzAwMDB9KSxcclxuICAgICAgICAzMjogQVJPYmplY3QuY3JlYXRlKHtjb2xvcjoweDAwQ0MwMH0pLFxyXG4gICAgICAgIDY0OiBBUk9iamVjdC5jcmVhdGUoe2NvbG9yOjB4MDAwMENDfSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIG9uQ3JlYXRlPWZ1bmN0aW9uKHZpZXcpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihtYXJrZXIpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNyZWF0ZWRcIilcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobWFya2VyLmlkKVxyXG4gICAgICAgICBcclxuICAgICAgICAgICAgdmFyIG9iamVjdD1vYmplY3RzW21hcmtlci5pZF07XHJcbiAgICAgICAgICAgIG9iamVjdC50cmFuc2Zvcm0obWFya2VyLm1hdHJpeCk7XHJcbiAgICAgICAgICAgIHZpZXcuYWRkKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG9uVXBkYXRlPWZ1bmN0aW9uKHZpZXcpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihtYXJrZXIpe1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRlXCIpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG1hcmtlci5pZClcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBvYmplY3Q9b2JqZWN0c1ttYXJrZXIuaWRdO1xyXG4gICAgICAgICAgICBvYmplY3QudHJhbnNmb3JtKG1hcmtlci5tYXRyaXgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YXIgb25EZXN0cm95PWZ1bmN0aW9uKHZpZXcpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihtYXJrZXIpe1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVtb3ZlXCIpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG1hcmtlci5pZClcclxuICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBvYmplY3Q9b2JqZWN0c1ttYXJrZXIuaWRdO1xyXG4gICAgICAgICAgICB2aWV3LnJlbW92ZShvYmplY3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgb25DcmVhdGU6b25DcmVhdGUsXHJcbiAgICAgICAgb25VcGRhdGU6b25VcGRhdGUsXHJcbiAgICAgICAgb25EZXN0cm95Om9uRGVzdHJveVxyXG4gICAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJPYmplY3QnLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgZnVuY3Rpb24gY3JlYXRlQ29udGFpbmVyKCkge1xyXG4gICAgICAgIHZhciBtb2RlbCA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xyXG4gICAgICAgIG1vZGVsLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gbW9kZWw7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlTWFya2VyTWVzaChjb2xvcikge1xyXG4gICAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5DdWJlR2VvbWV0cnkoIDEwMCwxMDAsMTAwICk7XHJcbiAgICAgICAgdmFyIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7Y29sb3I6Y29sb3IsIHNpZGU6VEhSRUUuRG91YmxlU2lkZSB9ICk7XHJcblxyXG4gICAgICAgIHZhciBtZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOyAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICBtZXNoLnBvc2l0aW9uLnogPSAtNTA7XHJcblxyXG4gICAgICAgIHJldHVybiBtZXNoO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZU1hcmtlck9iamVjdChwYXJhbXMpIHtcclxuICAgICAgICB2YXIgbW9kZWxDb250YWluZXIgPSBjcmVhdGVDb250YWluZXIoKTtcclxuXHJcbiAgICAgICAgdmFyIG1vZGVsTWVzaCA9IGNyZWF0ZU1hcmtlck1lc2gocGFyYW1zLmNvbG9yKTtcclxuICAgICAgICBtb2RlbENvbnRhaW5lci5hZGQoIG1vZGVsTWVzaCApO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB0cmFuc2Zvcm0obWF0cml4KSB7XHJcbiAgICAgICAgICAgIG1vZGVsQ29udGFpbmVyLnRyYW5zZm9ybUZyb21BcnJheSggbWF0cml4ICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybSxcclxuICAgICAgICAgICAgbW9kZWw6IG1vZGVsQ29udGFpbmVyXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNyZWF0ZTpjcmVhdGVNYXJrZXJPYmplY3RcclxuICAgIH1cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSVXRpbHMnLCBmdW5jdGlvbigkaW9uaWNQbGF0Zm9ybSkge1xyXG5cclxuICAgIHZhciBzaXplPWZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICAgICAgICBlbGVtLndpZHRoPXdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICBlbGVtLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzaXplOnNpemUsIFxyXG4gICAgICAgIHNldFZpZGVvU2l6ZTpmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgc2l6ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8nKSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcblxyXG5USFJFRS5NYXRyaXg0LnByb3RvdHlwZS5zZXRGcm9tQXJyYXkgPSBmdW5jdGlvbihtKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zZXQoXHJcbiAgICAgICAgbVswXSwgbVs0XSwgbVs4XSwgbVsxMl0sXHJcbiAgICAgICAgbVsxXSwgbVs1XSwgbVs5XSwgbVsxM10sXHJcbiAgICAgICAgbVsyXSwgbVs2XSwgbVsxMF0sIG1bMTRdLFxyXG4gICAgICAgIG1bM10sIG1bN10sIG1bMTFdLCBtWzE1XVxyXG4gICAgKTtcclxufVxyXG5cclxuVEhSRUUuT2JqZWN0M0QucHJvdG90eXBlLnRyYW5zZm9ybUZyb21BcnJheSA9IGZ1bmN0aW9uKG0pIHtcclxuICAgIHRoaXMubWF0cml4LnNldEZyb21BcnJheShtKTtcclxuICAgIHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7XHJcbn0iXX0=
