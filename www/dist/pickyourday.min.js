var app=angular.module("ar-toolkit",["ionic"]);angular.module("ar-toolkit").run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("ar-toolkit").directive("arView",["ARUtils","ARCamera","AR",function(e,t,r){return{restrict:"A",link:function(n,a,o){var i=a[0];e.size(i),t.wait(function(){r.init(i),r.tick()})}}}]),angular.module("ar-toolkit").factory("AR3D",function(){var e=function(e){function t(){o.needsUpdate=!0}var r=new THREE.Camera,n=new THREE.Scene,a=new THREE.PlaneGeometry(2,2,0),o=new THREE.Texture(e);o.generateMipmaps=!1,o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.wrapS=o.wrapT=THREE.ClampToEdgeWrapping;var i=new THREE.MeshBasicMaterial({map:o,depthTest:!1,depthWrite:!1}),c=new THREE.Mesh(a,i);return n.add(c),{camera:r,scene:n,update:t}},t=function(){function e(e){n.add(e)}function t(e){n.remove(e)}function r(e){a.projectionMatrix.setFromArray(e)}var n=new THREE.Scene,a=new THREE.Camera;return{scene:n,camera:a,add:e,remove:t,setProjectionMatrix:r}},r=function(r,n,a){function o(){l.render(s.scene,s.camera),l.render(m.scene,m.camera)}function i(){s.update()}function c(e){m.add(e.model)}function u(e){m.setProjectionMatrix(e)}function d(e){m.remove(e.model)}var l=new THREE.WebGLRenderer({canvas:r});l.setSize(n.width,n.height),l.autoClear=!1;var s=new e(a),m=new t,f=new THREE.SpotLight(16777215);return f.position.set(0,0,9e3),f.lookAt(new THREE.Vector3(0,0,0)),m.scene.add(f),{add:c,remove:d,update:i,render:o,glCanvas:r,setCameraMatrix:u}};return{create:r}}),angular.module("ar-toolkit").factory("ARCamera",["ARUtils",function(e){var t=document.getElementById("video");e.size(t);var r=function(e,t,r){var n=void 0;return navigator.getUserMedia?n=navigator.getUserMedia(e,t,r):navigator.webkitGetUserMedia&&(n=navigator.webkitGetUserMedia(e,t,r)),n},n=function(e){return function(r){var n=window.URL||window.webkitURL;t.src=n.createObjectURL(r),t.play(),e()}},a=function(e){console.log("An error occured! "+e)},o=function(e){r({video:!0,audio:!1},n(e),a)},i=function(){return{width:t.width,height:t.height}},c=function(e){e.drawImage(t,0,0)};return{wait:o,copyToContext:c,getDimensions:i}}]),angular.module("ar-toolkit").factory("ARDetector",function(){function e(e){var t=new NyARRgbRaster_Canvas2D(e),r=new FLARParam(e.width,e.height),n=new FLARMultiIdMarkerDetector(r,120);n.setContinueMode(!0);var a=function(e){var t=n.getIdMarkerData(e);if(t.packetLength>4)return-1;for(var r=0,a=0;a<t.packetLength;a++)r=r<<8|t.getPacketData(a);return r},o=function(e){var t=new NyARTransMatResult;n.getTransformMatrix(e,t);var r=new Float32Array(16);return r[0]=t.m00,r[1]=-t.m10,r[2]=t.m20,r[3]=0,r[4]=t.m01,r[5]=-t.m11,r[6]=t.m21,r[7]=0,r[8]=-t.m02,r[9]=t.m12,r[10]=-t.m22,r[11]=0,r[12]=t.m03,r[13]=-t.m13,r[14]=t.m23,r[15]=1,r},i=function(e,t){var n=new Float32Array(16);return r.copyCameraMatrix(n,e,t),n},c=1,u=function(e,t){return{id:e,matrix:t,age:c}},d={},l=function(e,r,i){for(var l=n.detectMarkerLite(t,70),s=0;l>s;s++){var m=a(s),f=d[m];void 0===f?(f=u(m,o(s)),d[m]=f,e(f)):(f.matrix=o(s),f.age=c,r(f))}for(var m in d){var f=d[m];f&&0==f.age--&&(i(f),delete d[m])}};return{detect:l,getCameraMatrix:i}}return{create:e}}),angular.module("ar-toolkit").factory("AR",["ARCamera","ARDetector","AR3D","ARMarker",function(e,t,r,n){var a,o,i,c,u=function(n){a=document.createElement("canvas");var u=e.getDimensions();console.log(u),a.width=u.width,a.height=u.height,o=a.getContext("2d"),i=t.create(a),c=r.create(n,u,a),c.setCameraMatrix(i.getCameraMatrix(10,1e3))},d=function(){e.copyToContext(o),a.changed=!0,i.detect(n.onCreate,n.onUpdate,n.onDestroy),c.update(),c.render(),window.requestAnimationFrame(d)};return{init:u,tick:d,getView:c}}]),angular.module("ar-toolkit").factory("ARMarker",function(){var e=function(e){console.log(e)},t=function(e){console.log(e)},r=function(e){console.log(e)};return{onCreate:e,onUpdate:t,onDestroy:r}}),angular.module("ar-toolkit").factory("ARUtils",["$ionicPlatform",function(e){return{size:function(t){t.width=window.innerWidth,t.height=window.innerHeight,e.ready(function(){t.width=window.innerWidth,t.height=window.innerHeight})}}}]),THREE.Matrix4.prototype.setFromArray=function(e){return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},THREE.Object3D.prototype.transformFromArray=function(e){this.matrix.setFromArray(e),this.matrixWorldNeedsUpdate=!0};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZy9ib290LmpzIiwiY29tcG9uZW50cy9kaXJlY3RpdmVzL2FyX3ZpZXdfZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfM2RfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2NhbWVyYV9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfZGV0ZWN0b3JfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2ZhY3RvcnkuanMiLCJjb21wb25lbnRzL2ZhY3Rvcmllcy9hcl9tYXJrZXJfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX3V0aWxzX2ZhY3RvcnkuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsInJ1biIsIiRpb25pY1BsYXRmb3JtIiwicmVhZHkiLCJ3aW5kb3ciLCJjb3Jkb3ZhIiwicGx1Z2lucyIsIktleWJvYXJkIiwiaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyIiwiZGlzYWJsZVNjcm9sbCIsIlN0YXR1c0JhciIsInN0eWxlRGVmYXVsdCIsImRpcmVjdGl2ZSIsIkFSVXRpbHMiLCJBUkNhbWVyYSIsIkFSIiwicmVzdHJpY3QiLCJsaW5rIiwic2NvcGUiLCJ0RWxlbWVudCIsImF0dHJzIiwiZWxlbSIsInNpemUiLCJ3YWl0IiwiaW5pdCIsInRpY2siLCJmYWN0b3J5IiwiUmVhbGl0eSIsInNvdXJjZUNhbnZhcyIsInVwZGF0ZSIsInRleHR1cmUiLCJuZWVkc1VwZGF0ZSIsImNhbWVyYSIsIlRIUkVFIiwiQ2FtZXJhIiwic2NlbmUiLCJTY2VuZSIsImdlb21ldHJ5IiwiUGxhbmVHZW9tZXRyeSIsIlRleHR1cmUiLCJnZW5lcmF0ZU1pcG1hcHMiLCJtaW5GaWx0ZXIiLCJOZWFyZXN0RmlsdGVyIiwibWFnRmlsdGVyIiwid3JhcFMiLCJ3cmFwVCIsIkNsYW1wVG9FZGdlV3JhcHBpbmciLCJtYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwibWFwIiwiZGVwdGhUZXN0IiwiZGVwdGhXcml0ZSIsIm1lc2giLCJNZXNoIiwiYWRkIiwib2JqZWN0IiwicmVtb3ZlIiwic2V0UHJvamVjdGlvbk1hdHJpeCIsIm1hdHJpeCIsInByb2plY3Rpb25NYXRyaXgiLCJzZXRGcm9tQXJyYXkiLCJjcmVhdGUiLCJnbENhbnZhcyIsImRpbWVuc2lvbnMiLCJyZW5kZXIiLCJyZW5kZXJlciIsInJlYWxpdHkiLCJ2aXJ0dWFsIiwibW9kZWwiLCJzZXRDYW1lcmFNYXRyaXgiLCJXZWJHTFJlbmRlcmVyIiwiY2FudmFzIiwic2V0U2l6ZSIsIndpZHRoIiwiaGVpZ2h0IiwiYXV0b0NsZWFyIiwibGlnaHQiLCJTcG90TGlnaHQiLCJwb3NpdGlvbiIsInNldCIsImxvb2tBdCIsIlZlY3RvcjMiLCJ2aWRlbyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRNZWRpYUNhcHR1cmUiLCJ0Iiwib25zdWNjZXNzIiwib25lcnJvciIsInJlc3VsdCIsInVuZGVmaW5lZCIsIm5hdmlnYXRvciIsImdldFVzZXJNZWRpYSIsIndlYmtpdEdldFVzZXJNZWRpYSIsIm9uU3VjY2VzcyIsImNiIiwic3RyZWFtIiwidmVuZG9yVVJMIiwiVVJMIiwid2Via2l0VVJMIiwic3JjIiwiY3JlYXRlT2JqZWN0VVJMIiwicGxheSIsIm9uRXJyb3IiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwid2FpdENhbWVyYSIsImNhbGxiYWNrIiwiYXVkaW8iLCJnZXREaW1lbnNpb25zIiwiY29weVRvQ29udGV4dCIsImNvbnRleHQiLCJkcmF3SW1hZ2UiLCJKU0FSUmFzdGVyIiwiTnlBUlJnYlJhc3Rlcl9DYW52YXMyRCIsIkpTQVJQYXJhbWV0ZXJzIiwiRkxBUlBhcmFtIiwiSlNBUkRldGVjdG9yIiwiRkxBUk11bHRpSWRNYXJrZXJEZXRlY3RvciIsInNldENvbnRpbnVlTW9kZSIsImdldE1hcmtlck51bWJlciIsImlkeCIsImRhdGEiLCJnZXRJZE1hcmtlckRhdGEiLCJwYWNrZXRMZW5ndGgiLCJpIiwiZ2V0UGFja2V0RGF0YSIsImdldFRyYW5zZm9ybU1hdHJpeCIsIm1hdCIsIk55QVJUcmFuc01hdFJlc3VsdCIsImNtIiwiRmxvYXQzMkFycmF5IiwibTAwIiwibTEwIiwibTIwIiwibTAxIiwibTExIiwibTIxIiwibTAyIiwibTEyIiwibTIyIiwibTAzIiwibTEzIiwibTIzIiwiZ2V0Q2FtZXJhTWF0cml4Iiwiek5lYXIiLCJ6RmFyIiwiY29weUNhbWVyYU1hdHJpeCIsInBlcnNpc3RUaW1lIiwibmV3TWFya2VyIiwiaWQiLCJhZ2UiLCJtYXJrZXJzIiwiZGV0ZWN0Iiwib25DcmVhdGUiLCJvblVwZGF0ZSIsIm9uRGVzdHJveSIsIm1hcmtlckNvdW50IiwiZGV0ZWN0TWFya2VyTGl0ZSIsImluZGV4IiwibWFya2VyIiwiQVJEZXRlY3RvciIsIkFSM0QiLCJBUk1hcmtlciIsImRldGVjdG9yIiwidmlldyIsImNyZWF0ZUVsZW1lbnQiLCJjYW1lcmFEaW1lbnNpb25zIiwiZ2V0Q29udGV4dCIsImNoYW5nZWQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJnZXRWaWV3IiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiTWF0cml4NCIsInByb3RvdHlwZSIsIm0iLCJ0aGlzIiwiT2JqZWN0M0QiLCJ0cmFuc2Zvcm1Gcm9tQXJyYXkiLCJtYXRyaXhXb3JsZE5lZWRzVXBkYXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLGNBQUEsU0NBQUQsU0FBQUMsT0FBQSxjQUNBQyxLQUFBLGlCQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLE1BQUEsV0FDQUMsT0FBQUMsU0FBQUQsT0FBQUMsUUFBQUMsUUFBQUMsV0FHQUYsUUFBQUMsUUFBQUMsU0FBQUMsMEJBQUEsR0FLQUgsUUFBQUMsUUFBQUMsU0FBQUUsZUFBQSxJQUVBTCxPQUFBTSxXQUNBQSxVQUFBQyxvQkNkQVosUUFBQUMsT0FBQSxjQUNBWSxVQUFBLFVBQUEsVUFBQSxXQUFBLEtBQUEsU0FB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TUFBQXJFLE9BQUF5SyxXQUNBeEosRUFBQXFELE9BQUF0RSxPQUFBMEssbUJBTUE3SSxNQUFBOEksUUFBQUMsVUFBQXBILGFBQUEsU0FBQXFILEdBQ0EsTUFBQUMsTUFBQW5HLElBQ0FrRyxFQUFBLEdBQUFBLEVBQUEsR0FBQUEsRUFBQSxHQUFBQSxFQUFBLElBQ0FBLEVBQUEsR0FBQUEsRUFBQSxHQUFBQSxFQUFBLEdBQUFBLEVBQUEsSUFDQUEsRUFBQSxHQUFBQSxFQUFBLEdBQUFBLEVBQUEsSUFBQUEsRUFBQSxJQUNBQSxFQUFBLEdBQUFBLEVBQUEsR0FBQUEsRUFBQSxJQUFBQSxFQUFBLE1BSUFoSixNQUFBa0osU0FBQUgsVUFBQUksbUJBQUEsU0FBQUgsR0FDQUMsS0FBQXhILE9BQUFFLGFBQUFxSCxHQUNBQyxLQUFBRyx3QkFBQSIsImZpbGUiOiJwaWNreW91cmRheS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwPWFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JywgWydpb25pYyddKVxuXG5cbiIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuLnJ1bihmdW5jdGlvbigkaW9uaWNQbGF0Zm9ybSkge1xyXG4gICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xyXG4gICAgaWYod2luZG93LmNvcmRvdmEgJiYgd2luZG93LmNvcmRvdmEucGx1Z2lucy5LZXlib2FyZCkge1xyXG4gICAgICAvLyBIaWRlIHRoZSBhY2Nlc3NvcnkgYmFyIGJ5IGRlZmF1bHQgKHJlbW92ZSB0aGlzIHRvIHNob3cgdGhlIGFjY2Vzc29yeSBiYXIgYWJvdmUgdGhlIGtleWJvYXJkXHJcbiAgICAgIC8vIGZvciBmb3JtIGlucHV0cylcclxuICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcclxuXHJcbiAgICAgIC8vIERvbid0IHJlbW92ZSB0aGlzIGxpbmUgdW5sZXNzIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy4gSXQgc3RvcHMgdGhlIHZpZXdwb3J0XHJcbiAgICAgIC8vIGZyb20gc25hcHBpbmcgd2hlbiB0ZXh0IGlucHV0cyBhcmUgZm9jdXNlZC4gSW9uaWMgaGFuZGxlcyB0aGlzIGludGVybmFsbHkgZm9yXHJcbiAgICAgIC8vIGEgbXVjaCBuaWNlciBrZXlib2FyZCBleHBlcmllbmNlLlxyXG4gICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuZGlzYWJsZVNjcm9sbCh0cnVlKTtcclxuICAgIH1cclxuICAgIGlmKHdpbmRvdy5TdGF0dXNCYXIpIHtcclxuICAgICAgU3RhdHVzQmFyLnN0eWxlRGVmYXVsdCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gICAgXHJcbiAgICBcclxufSkiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZGlyZWN0aXZlKCdhclZpZXcnLCBmdW5jdGlvbihBUlV0aWxzLCBBUkNhbWVyYSwgQVIpIHtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgbGluazpmdW5jdGlvbihzY29wZSwgdEVsZW1lbnQsIGF0dHJzKXtcclxuICAgICAgICAgICAgdmFyIGVsZW09dEVsZW1lbnRbMF07XHJcbiAgICAgICAgICAgICAgQVJVdGlscy5zaXplKGVsZW0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgQVJDYW1lcmEud2FpdChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgQVIuaW5pdChlbGVtKTtcclxuICAgICAgICAgICAgICAgIEFSLnRpY2soKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSM0QnLCBmdW5jdGlvbigpIHtcclxuXHJcblxyXG4gICAgdmFyIFJlYWxpdHk9ZnVuY3Rpb24oc291cmNlQ2FudmFzKXtcclxuXHJcbiAgICAgICAgdmFyIGNhbWVyYT0gbmV3IFRIUkVFLkNhbWVyYSgpO1xyXG4gICAgICAgIHZhciBzY2VuZT0gbmV3IFRIUkVFLlNjZW5lKCk7XHJcblxyXG4gICAgICAgIHZhciBnZW9tZXRyeT0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMiwyLDApO1xyXG4gICAgICAgIHZhciB0ZXh0dXJlPW5ldyBUSFJFRS5UZXh0dXJlKHNvdXJjZUNhbnZhcyk7XHJcbiAgICAgICAgdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTtcclxuICAgICAgICB0ZXh0dXJlLm1pbkZpbHRlciA9IFRIUkVFLk5lYXJlc3RGaWx0ZXI7XHJcbiAgICAgICAgdGV4dHVyZS5tYWdGaWx0ZXIgPSBUSFJFRS5OZWFyZXN0RmlsdGVyO1xyXG4gICAgICAgIHRleHR1cmUud3JhcFMgPSB0ZXh0dXJlLndyYXBUID1USFJFRS5DbGFtcFRvRWRnZVdyYXBwaW5nO1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG5cclxuXHJcbiAgICAgICAgdmFyIG1hdGVyaWFsPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6dGV4dHVyZSxcclxuICAgICAgICAgICAgZGVwdGhUZXN0OmZhbHNlLFxyXG4gICAgICAgICAgICBkZXB0aFdyaXRlOmZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBtZXNoPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpO1xyXG4gICAgICAgIHNjZW5lLmFkZChtZXNoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCl7XHJcbiAgICAgICAgICAgIHRleHR1cmUubmVlZHNVcGRhdGU9dHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNhbWVyYTogY2FtZXJhLFxyXG4gICAgICAgICAgICBzY2VuZTogc2NlbmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLCBcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBTY2VuZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG4gICAgICAgIHZhciBjYW1lcmEgPSBuZXcgVEhSRUUuQ2FtZXJhKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZChvYmplY3QpIHtcclxuICAgICAgICAgICAgc2NlbmUuYWRkKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUob2JqZWN0KSB7XHJcbiAgICAgICAgICAgIHNjZW5lLnJlbW92ZShvYmplY3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0UHJvamVjdGlvbk1hdHJpeChtYXRyaXgpIHtcclxuICAgICAgICAgICAgY2FtZXJhLnByb2plY3Rpb25NYXRyaXguc2V0RnJvbUFycmF5KCBtYXRyaXggKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjZW5lOnNjZW5lLFxyXG4gICAgICAgICAgICBjYW1lcmE6Y2FtZXJhLFxyXG4gICAgICAgICAgICBhZGQ6YWRkLFxyXG4gICAgICAgICAgICByZW1vdmU6cmVtb3ZlLFxyXG4gICAgICAgICAgICBzZXRQcm9qZWN0aW9uTWF0cml4OnNldFByb2plY3Rpb25NYXRyaXgsXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2YXIgY3JlYXRlPWZ1bmN0aW9uKGdsQ2FudmFzLCBkaW1lbnNpb25zLCBzb3VyY2VDYW52YXMpe1xyXG5cclxuICAgICAgICB2YXIgcmVuZGVyZXI9bmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoe2NhbnZhczpnbENhbnZhc30pO1xyXG4gICAgICAgIHJlbmRlcmVyLnNldFNpemUoZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQpO1xyXG4gICAgICAgIHJlbmRlcmVyLmF1dG9DbGVhcj1mYWxzZTtcclxuXHJcbiAgICAgICAgdmFyIHJlYWxpdHk9IG5ldyBSZWFsaXR5KHNvdXJjZUNhbnZhcyk7XHJcbiAgICAgICAgdmFyIHZpcnR1YWw9IG5ldyBTY2VuZSgpO1xyXG5cclxuICAgICAgICB2YXIgbGlnaHQ9bmV3IFRIUkVFLlNwb3RMaWdodCgweGZmZmZmZik7XHJcbiAgICAgICAgbGlnaHQucG9zaXRpb24uc2V0KDAsMCw5MDAwKTtcclxuICAgICAgICBsaWdodC5sb29rQXQobmV3IFRIUkVFLlZlY3RvcjMoMCwwLDApKTtcclxuICAgICAgICB2aXJ0dWFsLnNjZW5lLmFkZChsaWdodCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbmRlcigpe1xyXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIocmVhbGl0eS5zY2VuZSwgcmVhbGl0eS5jYW1lcmEpO1xyXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIodmlydHVhbC5zY2VuZSwgdmlydHVhbC5jYW1lcmEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCl7XHJcbiAgICAgICAgICAgIHJlYWxpdHkudXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGQob2JqZWN0KXtcclxuICAgICAgICAgICAgdmlydHVhbC5hZGQob2JqZWN0Lm1vZGVsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0Q2FtZXJhTWF0cml4KCBtYXRyaXggKSB7XHJcbiAgICAgICAgICAgIHZpcnR1YWwuc2V0UHJvamVjdGlvbk1hdHJpeCggbWF0cml4ICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUob2JqZWN0KXtcclxuICAgICAgICAgICAgdmlydHVhbC5yZW1vdmUob2JqZWN0Lm1vZGVsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFkZDogYWRkLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHJlbmRlcjogcmVuZGVyLFxyXG4gICAgICAgICAgICBnbENhbnZhczogZ2xDYW52YXMsXHJcbiAgICAgICAgICAgIHNldENhbWVyYU1hdHJpeDogc2V0Q2FtZXJhTWF0cml4LFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjcmVhdGU6Y3JlYXRlXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJDYW1lcmEnLCBmdW5jdGlvbiggQVJVdGlscykge1xyXG5cclxuICAgIHZhciB2aWRlbz0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvJyk7XHJcbiAgICBBUlV0aWxzLnNpemUodmlkZW8pO1xyXG5cclxuICAgIHZhciBnZXRNZWRpYUNhcHR1cmUgPSBmdW5jdGlvbih0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IG5hdmlnYXRvci5nZXRVc2VyTWVkaWEodCwgb25zdWNjZXNzLCBvbmVycm9yKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSh0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIG9uU3VjY2Vzcz1mdW5jdGlvbihjYil7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSl7XHJcbiAgICAgICAgICAgIHZhciB2ZW5kb3JVUkwgPSB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkw7XHJcbiAgICAgICAgICAgIHZpZGVvLnNyYyA9IHZlbmRvclVSTC5jcmVhdGVPYmplY3RVUkwoc3RyZWFtKTtcclxuICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xyXG4gICAgICAgICAgICBjYigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICB2YXIgb25FcnJvcj1mdW5jdGlvbihlcnIpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQW4gZXJyb3Igb2NjdXJlZCEgXCIgKyBlcnIpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2YXIgd2FpdENhbWVyYT1mdW5jdGlvbihjYWxsYmFjayl7XHJcblxyXG4gICAgICAgIGdldE1lZGlhQ2FwdHVyZSh7dmlkZW86IHRydWUsYXVkaW86IGZhbHNlfSwgb25TdWNjZXNzKGNhbGxiYWNrKSwgb25FcnJvcik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHZhciBnZXREaW1lbnNpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6dmlkZW8ud2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDp2aWRlby5oZWlnaHRcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGNvcHlUb0NvbnRleHQ9ZnVuY3Rpb24oY29udGV4dCl7XHJcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UodmlkZW8sIDAsMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB3YWl0OndhaXRDYW1lcmEsXHJcbiAgICAgICAgY29weVRvQ29udGV4dDpjb3B5VG9Db250ZXh0LFxyXG4gICAgICAgIGdldERpbWVuc2lvbnM6Z2V0RGltZW5zaW9uc1xyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSRGV0ZWN0b3InLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmVhdGUoc291cmNlQ2FudmFzKXtcclxuICAgICAgIHZhciBKU0FSUmFzdGVyID0gbmV3IE55QVJSZ2JSYXN0ZXJfQ2FudmFzMkQoc291cmNlQ2FudmFzKTtcclxuICAgICAgICB2YXIgSlNBUlBhcmFtZXRlcnMgPSBuZXcgRkxBUlBhcmFtKHNvdXJjZUNhbnZhcy53aWR0aCwgc291cmNlQ2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgdmFyIEpTQVJEZXRlY3RvciA9IG5ldyBGTEFSTXVsdGlJZE1hcmtlckRldGVjdG9yKEpTQVJQYXJhbWV0ZXJzLCAxMjApO1xyXG4gICAgICAgIEpTQVJEZXRlY3Rvci5zZXRDb250aW51ZU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIHZhciBnZXRNYXJrZXJOdW1iZXIgPSBmdW5jdGlvbihpZHgpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBKU0FSRGV0ZWN0b3IuZ2V0SWRNYXJrZXJEYXRhKGlkeCk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhLnBhY2tldExlbmd0aCA+IDQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciByZXN1bHQ9MDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLnBhY2tldExlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gKHJlc3VsdCA8PCA4KSB8IGRhdGEuZ2V0UGFja2V0RGF0YShpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBnZXRUcmFuc2Zvcm1NYXRyaXggPSBmdW5jdGlvbihpZHgpIHtcclxuICAgICAgICAgICAgdmFyIG1hdCA9IG5ldyBOeUFSVHJhbnNNYXRSZXN1bHQoKTtcclxuICAgICAgICAgICAgSlNBUkRldGVjdG9yLmdldFRyYW5zZm9ybU1hdHJpeChpZHgsIG1hdCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY20gPSBuZXcgRmxvYXQzMkFycmF5KDE2KTtcclxuICAgICAgICAgICAgY21bMF0gPSBtYXQubTAwO1xyXG4gICAgICAgICAgICBjbVsxXSA9IC1tYXQubTEwO1xyXG4gICAgICAgICAgICBjbVsyXSA9IG1hdC5tMjA7XHJcbiAgICAgICAgICAgIGNtWzNdID0gMDtcclxuICAgICAgICAgICAgY21bNF0gPSBtYXQubTAxO1xyXG4gICAgICAgICAgICBjbVs1XSA9IC1tYXQubTExO1xyXG4gICAgICAgICAgICBjbVs2XSA9IG1hdC5tMjE7XHJcbiAgICAgICAgICAgIGNtWzddID0gMDtcclxuICAgICAgICAgICAgY21bOF0gPSAtbWF0Lm0wMjtcclxuICAgICAgICAgICAgY21bOV0gPSBtYXQubTEyO1xyXG4gICAgICAgICAgICBjbVsxMF0gPSAtbWF0Lm0yMjtcclxuICAgICAgICAgICAgY21bMTFdID0gMDtcclxuICAgICAgICAgICAgY21bMTJdID0gbWF0Lm0wMztcclxuICAgICAgICAgICAgY21bMTNdID0gLW1hdC5tMTM7XHJcbiAgICAgICAgICAgIGNtWzE0XSA9IG1hdC5tMjM7XHJcbiAgICAgICAgICAgIGNtWzE1XSA9IDE7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY207XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZ2V0Q2FtZXJhTWF0cml4ID0gZnVuY3Rpb24oek5lYXIsIHpGYXIpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpO1xyXG4gICAgICAgICAgICBKU0FSUGFyYW1ldGVycy5jb3B5Q2FtZXJhTWF0cml4KHJlc3VsdCwgek5lYXIsIHpGYXIpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHBlcnNpc3RUaW1lID0gMTtcclxuICAgICAgICB2YXIgbmV3TWFya2VyID0gZnVuY3Rpb24oaWQsIG1hdHJpeCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgbWF0cml4OiBtYXRyaXgsXHJcbiAgICAgICAgICAgICAgICBhZ2U6IHBlcnNpc3RUaW1lLFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbWFya2VycyA9IHt9O1xyXG4gICAgICAgIHZhciBkZXRlY3QgPSBmdW5jdGlvbiggb25DcmVhdGUsIG9uVXBkYXRlLCBvbkRlc3Ryb3kgKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXJrZXJDb3VudCA9IEpTQVJEZXRlY3Rvci5kZXRlY3RNYXJrZXJMaXRlKEpTQVJSYXN0ZXIsIDcwKTsgXHJcbiAgICAgICAgICAgIGZvciggdmFyIGluZGV4ID0gMDsgaW5kZXggPCBtYXJrZXJDb3VudDsgaW5kZXgrKyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZCA9IGdldE1hcmtlck51bWJlcihpbmRleCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbWFya2Vyc1tpZF07XHJcbiAgICAgICAgICAgICAgICBpZiggbWFya2VyID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyID0gbmV3TWFya2VyKGlkLCBnZXRUcmFuc2Zvcm1NYXRyaXgoaW5kZXgpKTtcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzW2lkXSA9IG1hcmtlcjtcclxuICAgICAgICAgICAgICAgICAgICBvbkNyZWF0ZSggbWFya2VyICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXIubWF0cml4ID0gZ2V0VHJhbnNmb3JtTWF0cml4KGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXIuYWdlID0gcGVyc2lzdFRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgb25VcGRhdGUoIG1hcmtlciApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IoIHZhciBpZCBpbiBtYXJrZXJzICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNbaWRdO1xyXG4gICAgICAgICAgICAgICAgaWYoIG1hcmtlciApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiggbWFya2VyLmFnZS0tID09IDAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRGVzdHJveSggbWFya2VyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBtYXJrZXJzW2lkXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICBkZXRlY3Q6IGRldGVjdCxcclxuICAgICAgICAgICAgZ2V0Q2FtZXJhTWF0cml4OiBnZXRDYW1lcmFNYXRyaXhcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgY3JlYXRlOmNyZWF0ZVxyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSJywgZnVuY3Rpb24oQVJDYW1lcmEsIEFSRGV0ZWN0b3IsIEFSM0QsIEFSTWFya2VyKSB7XHJcblxyXG4gICAgdmFyIGNhbnZhcywgY29udGV4dCwgZGV0ZWN0b3IsIHZpZXc7XHJcbiAgICB2YXIgaW5pdD1mdW5jdGlvbihnbENhbnZhcyl7XHJcblxyXG4gICAgICAgIGNhbnZhcz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xyXG4gICAgICAgIHZhciBjYW1lcmFEaW1lbnNpb25zPUFSQ2FtZXJhLmdldERpbWVuc2lvbnMoKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhjYW1lcmFEaW1lbnNpb25zKVxyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IGNhbWVyYURpbWVuc2lvbnMud2lkdGg7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGNhbWVyYURpbWVuc2lvbnMuaGVpZ2h0O1xyXG5cclxuICAgICAgICBjb250ZXh0PWNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4gICAgICAgIGRldGVjdG9yPUFSRGV0ZWN0b3IuY3JlYXRlKGNhbnZhcyk7XHJcblxyXG4gICAgICAgIHZpZXc9QVIzRC5jcmVhdGUoZ2xDYW52YXMsIGNhbWVyYURpbWVuc2lvbnMsIGNhbnZhcyk7XHJcblxyXG4gICAgICAgIHZpZXcuc2V0Q2FtZXJhTWF0cml4KCBkZXRlY3Rvci5nZXRDYW1lcmFNYXRyaXgoMTAsMTAwMCkgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRpY2s9ZnVuY3Rpb24oKXtcclxuICAgICAgICBBUkNhbWVyYS5jb3B5VG9Db250ZXh0KGNvbnRleHQpO1xyXG4gICAgICAgIGNhbnZhcy5jaGFuZ2VkPXRydWU7XHJcblxyXG4gICAgICAgIGRldGVjdG9yLmRldGVjdChBUk1hcmtlci5vbkNyZWF0ZSwgQVJNYXJrZXIub25VcGRhdGUsIEFSTWFya2VyLm9uRGVzdHJveSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmlldy51cGRhdGUoKTtcclxuICAgICAgICB2aWV3LnJlbmRlcigpO1xyXG5cclxuXHJcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGluaXQ6aW5pdCxcclxuICAgICAgICB0aWNrOnRpY2ssXHJcbiAgICAgICAgZ2V0Vmlldzp2aWV3XHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJNYXJrZXInLCBmdW5jdGlvbigpIHtcclxuXHJcblxyXG4gICAgdmFyIG9uQ3JlYXRlPWZ1bmN0aW9uKG1hcmtlcil7XHJcbiAgICAgICAgY29uc29sZS5sb2cobWFya2VyKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgb25VcGRhdGU9ZnVuY3Rpb24obWFya2VyKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhtYXJrZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBvbkRlc3Ryb3k9ZnVuY3Rpb24obWFya2VyKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhtYXJrZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBvbkNyZWF0ZTpvbkNyZWF0ZSxcclxuICAgICAgICBvblVwZGF0ZTpvblVwZGF0ZSxcclxuICAgICAgICBvbkRlc3Ryb3k6b25EZXN0cm95XHJcbiAgICB9XHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUlV0aWxzJywgZnVuY3Rpb24oJGlvbmljUGxhdGZvcm0pIHtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHNpemU6ZnVuY3Rpb24oZWxlbSl7XHJcbiAgICAgICAgICAgIGVsZW0ud2lkdGg9d2luZG93LmlubmVyV2lkdGg7XHJcbiAgICAgICAgICAgIGVsZW0uaGVpZ2h0PXdpbmRvdy5pbm5lckhlaWdodDtcclxuXHJcbiAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgIGVsZW0ud2lkdGg9d2luZG93LmlubmVyV2lkdGg7XHJcbiAgICAgICAgICAgIGVsZW0uaGVpZ2h0PXdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxuXHJcblRIUkVFLk1hdHJpeDQucHJvdG90eXBlLnNldEZyb21BcnJheSA9IGZ1bmN0aW9uKG0pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZXQoXHJcbiAgICAgICAgICBtWzBdLCBtWzRdLCBtWzhdLCBtWzEyXSxcclxuICAgICAgICAgIG1bMV0sIG1bNV0sIG1bOV0sIG1bMTNdLFxyXG4gICAgICAgICAgbVsyXSwgbVs2XSwgbVsxMF0sIG1bMTRdLFxyXG4gICAgICAgICAgbVszXSwgbVs3XSwgbVsxMV0sIG1bMTVdXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBUSFJFRS5PYmplY3QzRC5wcm90b3R5cGUudHJhbnNmb3JtRnJvbUFycmF5ID0gZnVuY3Rpb24obSkge1xyXG4gICAgICAgIHRoaXMubWF0cml4LnNldEZyb21BcnJheShtKTtcclxuICAgICAgICB0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlO1xyXG4gICAgfSJdfQ==
