var app=angular.module("ar-toolkit",["ionic"]);angular.module("ar-toolkit").run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("ar-toolkit").controller("ARController",["$scope",function(e){var t=new THREE.BoxGeometry(1,1,1),n=new THREE.MeshPhongMaterial({color:8375321,shininess:230,wireframe:!0}),o=new THREE.Mesh(t,n);o.position.x=-1,o.position.z=-5,e.actions={onCreate:function(e,t){console.log("create"),e.add(o)},onUpdate:function(e,t){console.log("update"),o.rotation.x+=.1,o.rotation.y+=.1},onDestroy:function(e,t){console.log("remove"),e.remove(o)}}}]),angular.module("ar-toolkit").directive("arView",["ARUtils","ARCamera","AR","$ionicPlatform",function(e,t,n,o){return{restrict:"A",scope:{actions:"=actions"},link:function(r,a,i){var c=a[0];console.log(r.actions),o.ready(function(){e.size(c),e.setVideoSize(),t.wait(function(){n.init(c,r.actions),n.tick()})})}}}]),angular.module("ar-toolkit").factory("AR3D",function(){var e=function(e){function t(){a.needsUpdate=!0}var n=new THREE.Camera,o=new THREE.Scene,r=new THREE.PlaneGeometry(2,2,0),a=new THREE.Texture(e);a.generateMipmaps=!1,a.minFilter=THREE.NearestFilter,a.magFilter=THREE.NearestFilter,a.wrapS=a.wrapT=THREE.ClampToEdgeWrapping;var i=new THREE.MeshBasicMaterial({map:a,depthTest:!1,depthWrite:!1}),c=new THREE.Mesh(r,i);return o.add(c),{camera:n,scene:o,update:t}},t=function(){function e(e){n.add(e)}function t(e){n.remove(e)}var n=new THREE.Scene,o=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);return o.position.z=5,{scene:n,camera:o,add:e,remove:t}},n=function(n,o,r){function a(){d.render(l.scene,l.camera),d.render(s.scene,s.camera)}function i(){l.update()}function c(e){s.add(e)}function u(e){s.remove(e)}var d=new THREE.WebGLRenderer({canvas:n,antialias:!0});d.setSize(o.width,o.height),d.setPixelRatio(window.devicePixelRatio),d.autoClear=!1;var l=new e(r),s=new t,m=new THREE.SpotLight(16777215);return m.position.set(0,0,9e3),m.lookAt(new THREE.Vector3(0,0,0)),s.scene.add(m),{add:c,remove:u,update:i,render:a,glCanvas:n,virtual:s.scene}};return{create:n}}),angular.module("ar-toolkit").factory("ARCamera",["ARUtils","$ionicPlatform",function(e,t){var n=document.getElementById("video"),o=function(e,t,n){var o=void 0;return navigator.getUserMedia?o=navigator.getUserMedia(e,t,n):navigator.webkitGetUserMedia&&(o=navigator.webkitGetUserMedia(e,t,n)),o},r=function(e){return function(t){var o=window.URL||window.webkitURL;n.src=o.createObjectURL(t),n.play(),e()}},a=function(e){console.log("An error occured! "+e)},i=function(e){o({video:!0,audio:!1},r(e),a)},c=function(){return{width:n.width,height:n.height}},u=function(e){e.drawImage(n,0,0)};return{wait:i,copyToContext:u,getDimensions:c}}]),angular.module("ar-toolkit").factory("ARDetector",function(){function e(e){var t=new NyARRgbRaster_Canvas2D(e),n=new FLARParam(e.width,e.height),o=new FLARMultiIdMarkerDetector(n,120);o.setContinueMode(!0);var r=function(e){var t=o.getIdMarkerData(e);if(t.packetLength>4)return-1;for(var n=0,r=0;r<t.packetLength;r++)n=n<<8|t.getPacketData(r);return n},a=function(e){var t=new NyARTransMatResult;o.getTransformMatrix(e,t);var n=new Float32Array(16);return n[0]=t.m00,n[1]=-t.m10,n[2]=t.m20,n[3]=0,n[4]=t.m01,n[5]=-t.m11,n[6]=t.m21,n[7]=0,n[8]=-t.m02,n[9]=t.m12,n[10]=-t.m22,n[11]=0,n[12]=t.m03,n[13]=-t.m13,n[14]=t.m23,n[15]=1,n},i=function(e,t){var o=new Float32Array(16);return n.copyCameraMatrix(o,e,t),o},c=1,u=function(e,t){return{id:e,matrix:t,age:c}},d={},l=function(e,n,i){for(var l=o.detectMarkerLite(t,70),s=0;l>s;s++){var m=r(s),f=d[m];void 0===f?(f=u(m,a(s)),d[m]=f,e(f)):(f.matrix=a(s),f.age=c,n(f))}for(var m in d){var f=d[m];f&&0==f.age--&&(i(f),delete d[m])}};return{detect:l,getCameraMatrix:i}}return{create:e}}),angular.module("ar-toolkit").factory("AR",["ARCamera","ARDetector","AR3D","ARMarker",function(e,t,n,o){var r,a,i,c,u,d=function(d,l){l=l||{},u={},r=document.createElement("canvas");var s=e.getDimensions();r.width=s.width,r.height=s.height,a=r.getContext("2d"),i=t.create(r),c=n.create(d,s,r),u.onCreate=o.Primitive(c,l.onCreate||o.onCreate),u.onUpdate=o.Primitive(c,l.onUpdate||o.onUpdate),u.onDestroy=o.Primitive(c,l.onDestroy||o.onDestroy)},l=function(){e.copyToContext(a),r.changed=!0,i.detect(u.onCreate,u.onUpdate,u.onDestroy),c.update(),c.render(),window.requestAnimationFrame(l)};return{init:d,tick:l}}]),angular.module("ar-toolkit").factory("ARMarker",["ARObject",function(e){var t={16:e.create({color:13369344}),32:e.create({color:52224}),64:e.create({color:204})},n=function(e,n){console.log("Created"),console.log(n.id);var o=t[n.id];o.rotation.x+=.1,o.rotation.y+=.1,e.add(o)},o=function(e,n){console.log("update"),console.log(n.id);var o=t[n.id];o.rotation.x+=.1,o.rotation.y+=.1},r=function(e,n){console.log("remove"),console.log(n.id);var o=t[n.id];e.remove(o)},a=function(e,t){return console.log(t),function(n){t(e,n)}};return{Primitive:a,onCreate:n,onUpdate:o,onDestroy:r}}]),angular.module("ar-toolkit").factory("ARObject",function(){function e(e){var t=new THREE.BoxGeometry(1,1,1),n=new THREE.MeshBasicMaterial({color:e}),o=new THREE.Mesh(t,n);return o.position.z=-5,o}function t(t){return e(t.color)}return{create:t}}),angular.module("ar-toolkit").factory("ARUtils",["$ionicPlatform",function(e){var t=function(e){e.width=window.innerWidth,e.height=window.innerHeight};return{size:t,setVideoSize:function(){t(document.getElementById("video"))}}}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZy9ib290LmpzIiwiY29tcG9uZW50cy9jb250cm9sbGVycy9hcl9jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9kaXJlY3RpdmVzL2FyX3ZpZXdfZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfM2RfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2NhbWVyYV9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfZGV0ZWN0b3JfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2ZhY3RvcnkuanMiLCJjb21wb25lbnRzL2ZhY3Rvcmllcy9hcl9tYXJrZXJfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX29iamVjdF9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfdXRpbHNfZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwicnVuIiwiJGlvbmljUGxhdGZvcm0iLCJyZWFkeSIsIndpbmRvdyIsImNvcmRvdmEiLCJwbHVnaW5zIiwiS2V5Ym9hcmQiLCJoaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIiLCJkaXNhYmxlU2Nyb2xsIiwiU3RhdHVzQmFyIiwic3R5bGVEZWZhdWx0IiwiY29udHJvbGxlciIsIiRzY29wZSIsImdlb21ldHJ5IiwiVEhSRUUiLCJCb3hHZW9tZXRyeSIsIm1hdGVyaWFsIiwiTWVzaFBob25nTWF0ZXJpYWwiLCJjb2xvciIsInNoaW5pbmVzcyIsIndpcmVmcmFtZSIsImN1YmUiLCJNZXNoIiwicG9zaXRpb24iLCJ4IiwieiIsImFjdGlvbnMiLCJvbkNyZWF0ZSIsInZpZXciLCJtYXJrZXIiLCJjb25zb2xlIiwibG9nIiwiYWRkIiwib25VcGRhdGUiLCJyb3RhdGlvbiIsInkiLCJvbkRlc3Ryb3kiLCJyZW1vdmUiLCJkaXJlY3RpdmUiLCJBUlV0aWxzIiwiQVJDYW1lcmEiLCJBUiIsInJlc3RyaWN0Iiwic2NvcGUiLCJsaW5rIiwidEVsZW1lbnQiLCJhdHRycyIsImVsZW0iLCJzaXplIiwic2V0VmlkZW9TaXplIiwid2FpdCIsImluaXQiLCJ0aWNrIiwiZmFjdG9yeSIsIlJlYWxpdHkiLCJzb3VyY2VDYW52YXMiLCJ1cGRhdGUiLCJ0ZXh0dXJlIiwibmVlZHNVcGRhdGUiLCJjYW1lcmEiLCJDYW1lcmEiLCJzY2VuZSIsIlNjZW5lIiwiUGxhbmVHZW9tZXRyeSIsIlRleHR1cmUiLCJnZW5lcmF0ZU1pcG1hcHMiLCJtaW5GaWx0ZXIiLCJOZWFyZXN0RmlsdGVyIiwibWFnRmlsdGVyIiwid3JhcFMiLCJ3cmFwVCIsIkNsYW1wVG9FZGdlV3JhcHBpbmciLCJNZXNoQmFzaWNNYXRlcmlhbCIsIm1hcCIsImRlcHRoVGVzdCIsImRlcHRoV3JpdGUiLCJtZXNoIiwib2JqZWN0IiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJjcmVhdGUiLCJnbENhbnZhcyIsImRpbWVuc2lvbnMiLCJyZW5kZXIiLCJyZW5kZXJlciIsInJlYWxpdHkiLCJ2aXJ0dWFsIiwiV2ViR0xSZW5kZXJlciIsImNhbnZhcyIsImFudGlhbGlhcyIsInNldFNpemUiLCJ3aWR0aCIsImhlaWdodCIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiYXV0b0NsZWFyIiwibGlnaHQiLCJTcG90TGlnaHQiLCJzZXQiLCJsb29rQXQiLCJWZWN0b3IzIiwidmlkZW8iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0TWVkaWFDYXB0dXJlIiwidCIsIm9uc3VjY2VzcyIsIm9uZXJyb3IiLCJyZXN1bHQiLCJ1bmRlZmluZWQiLCJuYXZpZ2F0b3IiLCJnZXRVc2VyTWVkaWEiLCJ3ZWJraXRHZXRVc2VyTWVkaWEiLCJvblN1Y2Nlc3MiLCJjYiIsInN0cmVhbSIsInZlbmRvclVSTCIsIlVSTCIsIndlYmtpdFVSTCIsInNyYyIsImNyZWF0ZU9iamVjdFVSTCIsInBsYXkiLCJvbkVycm9yIiwiZXJyIiwid2FpdENhbWVyYSIsImNhbGxiYWNrIiwiYXVkaW8iLCJnZXREaW1lbnNpb25zIiwiY29weVRvQ29udGV4dCIsImNvbnRleHQiLCJkcmF3SW1hZ2UiLCJKU0FSUmFzdGVyIiwiTnlBUlJnYlJhc3Rlcl9DYW52YXMyRCIsIkpTQVJQYXJhbWV0ZXJzIiwiRkxBUlBhcmFtIiwiSlNBUkRldGVjdG9yIiwiRkxBUk11bHRpSWRNYXJrZXJEZXRlY3RvciIsInNldENvbnRpbnVlTW9kZSIsImdldE1hcmtlck51bWJlciIsImlkeCIsImRhdGEiLCJnZXRJZE1hcmtlckRhdGEiLCJwYWNrZXRMZW5ndGgiLCJpIiwiZ2V0UGFja2V0RGF0YSIsImdldFRyYW5zZm9ybU1hdHJpeCIsIm1hdCIsIk55QVJUcmFuc01hdFJlc3VsdCIsImNtIiwiRmxvYXQzMkFycmF5IiwibTAwIiwibTEwIiwibTIwIiwibTAxIiwibTExIiwibTIxIiwibTAyIiwibTEyIiwibTIyIiwibTAzIiwibTEzIiwibTIzIiwiZ2V0Q2FtZXJhTWF0cml4Iiwiek5lYXIiLCJ6RmFyIiwiY29weUNhbWVyYU1hdHJpeCIsInBlcnNpc3RUaW1lIiwibmV3TWFya2VyIiwiaWQiLCJtYXRyaXgiLCJhZ2UiLCJtYXJrZXJzIiwiZGV0ZWN0IiwibWFya2VyQ291bnQiLCJkZXRlY3RNYXJrZXJMaXRlIiwiaW5kZXgiLCJBUkRldGVjdG9yIiwiQVIzRCIsIkFSTWFya2VyIiwiZGV0ZWN0b3IiLCJtYXJrZXJfYWN0aW9ucyIsImNyZWF0ZUVsZW1lbnQiLCJjYW1lcmFEaW1lbnNpb25zIiwiZ2V0Q29udGV4dCIsIlByaW1pdGl2ZSIsImNoYW5nZWQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJBUk9iamVjdCIsIm9iamVjdHMiLDE2LDMyLDY0LCJjcmVhdGVDdWJlIiwiY3JlYXRlTWFya2VyT2JqZWN0IiwicGFyYW1zIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLGNBQUEsU0NBQUQsU0FBQUMs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LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcD1hbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcsIFsnaW9uaWMnXSlcblxuXG4gICAgICAgICAgXG5cdFx0IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4ucnVuKGZ1bmN0aW9uKCRpb25pY1BsYXRmb3JtKSB7XHJcbiAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XHJcbiAgICBpZih3aW5kb3cuY29yZG92YSAmJiB3aW5kb3cuY29yZG92YS5wbHVnaW5zLktleWJvYXJkKSB7XHJcbiAgICAgIC8vIEhpZGUgdGhlIGFjY2Vzc29yeSBiYXIgYnkgZGVmYXVsdCAocmVtb3ZlIHRoaXMgdG8gc2hvdyB0aGUgYWNjZXNzb3J5IGJhciBhYm92ZSB0aGUga2V5Ym9hcmRcclxuICAgICAgLy8gZm9yIGZvcm0gaW5wdXRzKVxyXG4gICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyKHRydWUpO1xyXG5cclxuICAgICAgLy8gRG9uJ3QgcmVtb3ZlIHRoaXMgbGluZSB1bmxlc3MgeW91IGtub3cgd2hhdCB5b3UgYXJlIGRvaW5nLiBJdCBzdG9wcyB0aGUgdmlld3BvcnRcclxuICAgICAgLy8gZnJvbSBzbmFwcGluZyB3aGVuIHRleHQgaW5wdXRzIGFyZSBmb2N1c2VkLiBJb25pYyBoYW5kbGVzIHRoaXMgaW50ZXJuYWxseSBmb3JcclxuICAgICAgLy8gYSBtdWNoIG5pY2VyIGtleWJvYXJkIGV4cGVyaWVuY2UuXHJcbiAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5kaXNhYmxlU2Nyb2xsKHRydWUpO1xyXG4gICAgfVxyXG4gICAgaWYod2luZG93LlN0YXR1c0Jhcikge1xyXG4gICAgICBTdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XHJcbiAgICB9XHJcbiAgICBcclxuICB9KTtcclxuICAgIFxyXG4gICAgXHJcbn0pIiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0FSQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG5cclxuXHJcbiAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEsIDEsIDEgKTtcclxuICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbCggeyBjb2xvcjogMHg3RkNDMTksIHNoaW5pbmVzczoyMzAsIHdpcmVmcmFtZTp0cnVlfSApO1xyXG4gICAgdmFyIGN1YmUgPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7XHJcbiAgICAgY3ViZS5wb3NpdGlvbi54PS0xO1xyXG4gICAgY3ViZS5wb3NpdGlvbi56PS01O1xyXG5cclxuICAgIFxyXG4gICAgJHNjb3BlLmFjdGlvbnM9e1xyXG5cclxuICAgICAgICBvbkNyZWF0ZTpmdW5jdGlvbih2aWV3LCBtYXJrZXIpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNyZWF0ZVwiKVxyXG4gICAgICAgICAgICB2aWV3LmFkZChjdWJlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9uVXBkYXRlOmZ1bmN0aW9uKHZpZXcsIG1hcmtlcil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRlXCIpXHJcbiAgICAgICAgICAgIGN1YmUucm90YXRpb24ueCArPSAwLjE7XHJcbiAgICAgICAgICAgIGN1YmUucm90YXRpb24ueSArPSAwLjE7XHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb25EZXN0cm95OmZ1bmN0aW9uKHZpZXcsIG1hcmtlcil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVtb3ZlXCIpXHJcbiAgICAgICAgICAgIHZpZXcucmVtb3ZlKGN1YmUpO1xyXG4gICAgICAgIH0gICAgIFxyXG5cclxuXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZGlyZWN0aXZlKCdhclZpZXcnLCBmdW5jdGlvbihBUlV0aWxzLCBBUkNhbWVyYSwgQVIsICRpb25pY1BsYXRmb3JtKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICBzY29wZTp7XHJcbiAgICAgICAgICAgIGFjdGlvbnM6XCI9YWN0aW9uc1wiXHJcbiAgICAgICAgfSxcclxuICAgICAgICBsaW5rOmZ1bmN0aW9uKHNjb3BlLCB0RWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICB2YXIgZWxlbT10RWxlbWVudFswXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNjb3BlLmFjdGlvbnMpXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIEFSVXRpbHMuc2l6ZShlbGVtKTtcclxuICAgICAgICAgICAgICAgIEFSVXRpbHMuIHNldFZpZGVvU2l6ZSgpO1xyXG4gICAgICAgICAgICAgICAgQVJDYW1lcmEud2FpdChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIEFSLmluaXQoZWxlbSwgc2NvcGUuYWN0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgQVIudGljaygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUjNEJywgZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHZhciBSZWFsaXR5PWZ1bmN0aW9uKHNvdXJjZUNhbnZhcyl7XHJcblxyXG4gICAgICAgIHZhciBjYW1lcmE9IG5ldyBUSFJFRS5DYW1lcmEoKTtcclxuICAgICAgICB2YXIgc2NlbmU9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICAgICAgICB2YXIgZ2VvbWV0cnk9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDIsMiwwKTtcclxuICAgICAgICB2YXIgdGV4dHVyZT1uZXcgVEhSRUUuVGV4dHVyZShzb3VyY2VDYW52YXMpO1xyXG4gICAgICAgIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7XHJcbiAgICAgICAgdGV4dHVyZS5taW5GaWx0ZXIgPSBUSFJFRS5OZWFyZXN0RmlsdGVyO1xyXG4gICAgICAgIHRleHR1cmUubWFnRmlsdGVyID0gVEhSRUUuTmVhcmVzdEZpbHRlcjtcclxuICAgICAgICB0ZXh0dXJlLndyYXBTID0gdGV4dHVyZS53cmFwVCA9VEhSRUUuQ2xhbXBUb0VkZ2VXcmFwcGluZztcclxuXHJcblxyXG4gICAgICAgIHZhciBtYXRlcmlhbD0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOnRleHR1cmUsXHJcbiAgICAgICAgICAgIGRlcHRoVGVzdDpmYWxzZSxcclxuICAgICAgICAgICAgZGVwdGhXcml0ZTpmYWxzZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgbWVzaD0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsKTtcclxuICAgICAgICBzY2VuZS5hZGQobWVzaCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSgpe1xyXG4gICAgICAgICAgICB0ZXh0dXJlLm5lZWRzVXBkYXRlPXRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjYW1lcmE6IGNhbWVyYSxcclxuICAgICAgICAgICAgc2NlbmU6IHNjZW5lLFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSwgXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgU2NlbmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcclxuICAgICAgICB2YXIgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCA3NSwgd2luZG93LmlubmVyV2lkdGgvd2luZG93LmlubmVySGVpZ2h0LCAwLjEsIDEwMDAgKTtcclxuICAgICAgICBcdGNhbWVyYS5wb3NpdGlvbi56ID0gNTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkKG9iamVjdCkge1xyXG5cclxuICAgICAgICAgICAgc2NlbmUuYWRkKG9iamVjdCk7XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShvYmplY3QpIHtcclxuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICBcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzY2VuZTpzY2VuZSxcclxuICAgICAgICAgICAgY2FtZXJhOmNhbWVyYSxcclxuICAgICAgICAgICAgYWRkOmFkZCxcclxuICAgICAgICAgICAgcmVtb3ZlOnJlbW92ZVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIGNyZWF0ZT1mdW5jdGlvbihnbENhbnZhcywgZGltZW5zaW9ucywgc291cmNlQ2FudmFzKXtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlcmVyPW5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHtjYW52YXM6Z2xDYW52YXMsIGFudGlhbGlhczogdHJ1ZSB9KTtcclxuICAgICAgICByZW5kZXJlci5zZXRTaXplKGRpbWVuc2lvbnMud2lkdGgsIGRpbWVuc2lvbnMuaGVpZ2h0KTtcclxuICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyApO1xyXG4gICAgICAgIHJlbmRlcmVyLmF1dG9DbGVhcj1mYWxzZTtcclxuXHJcbiAgICAgICAgdmFyIHJlYWxpdHk9IG5ldyBSZWFsaXR5KHNvdXJjZUNhbnZhcyk7XHJcbiAgICAgICAgdmFyIHZpcnR1YWw9IG5ldyBTY2VuZSgpO1xyXG5cclxuICAgICAgICB2YXIgbGlnaHQ9bmV3IFRIUkVFLlNwb3RMaWdodCgweGZmZmZmZik7XHJcbiAgICAgICAgbGlnaHQucG9zaXRpb24uc2V0KDAsMCw5MDAwKTtcclxuICAgICAgICBsaWdodC5sb29rQXQobmV3IFRIUkVFLlZlY3RvcjMoMCwwLDApKTtcclxuICAgICAgICB2aXJ0dWFsLnNjZW5lLmFkZChsaWdodCk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCl7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcihyZWFsaXR5LnNjZW5lLCByZWFsaXR5LmNhbWVyYSk7XHJcblxyXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIodmlydHVhbC5zY2VuZSwgdmlydHVhbC5jYW1lcmEpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSgpe1xyXG4gICAgICAgICAgICAgcmVhbGl0eS51cGRhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZChvYmplY3Qpe1xyXG4gICAgICAgICAgICAgIHZpcnR1YWwuYWRkKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShvYmplY3Qpe1xyXG4gICAgICAgICAgICAgdmlydHVhbC5yZW1vdmUob2JqZWN0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFkZDogYWRkLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHJlbmRlcjogcmVuZGVyLFxyXG4gICAgICAgICAgICBnbENhbnZhczogZ2xDYW52YXMsXHJcbiAgICAgICAgICAgIHZpcnR1YWw6dmlydHVhbC5zY2VuZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjcmVhdGU6Y3JlYXRlXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJDYW1lcmEnLCBmdW5jdGlvbiggQVJVdGlscywgJGlvbmljUGxhdGZvcm0pIHtcclxuXHJcbiAgICB2YXIgdmlkZW89IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlbycpO1xyXG4gXHJcbiAgICB2YXIgZ2V0TWVkaWFDYXB0dXJlID0gZnVuY3Rpb24odCwgb25zdWNjZXNzLCBvbmVycm9yKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLmdldFVzZXJNZWRpYSkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhKHQsIG9uc3VjY2Vzcywgb25lcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIGlmIChuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEodCwgb25zdWNjZXNzLCBvbmVycm9yKTtcclxuICAgICAgICB9IFxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBvblN1Y2Nlc3M9ZnVuY3Rpb24oY2Ipe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzdHJlYW0pe1xyXG4gICAgICAgICAgICB2YXIgdmVuZG9yVVJMID0gd2luZG93LlVSTCB8fCB3aW5kb3cud2Via2l0VVJMO1xyXG4gICAgICAgICAgICB2aWRlby5zcmMgPSB2ZW5kb3JVUkwuY3JlYXRlT2JqZWN0VVJMKHN0cmVhbSk7XHJcbiAgICAgICAgICAgIHZpZGVvLnBsYXkoKTtcclxuICAgICAgICAgICAgY2IoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgdmFyIG9uRXJyb3I9ZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkFuIGVycm9yIG9jY3VyZWQhIFwiICsgZXJyKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIHdhaXRDYW1lcmE9ZnVuY3Rpb24oY2FsbGJhY2spe1xyXG5cclxuICAgICAgICBnZXRNZWRpYUNhcHR1cmUoe3ZpZGVvOiB0cnVlLGF1ZGlvOiBmYWxzZX0sIG9uU3VjY2VzcyhjYWxsYmFjayksIG9uRXJyb3IpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YXIgZ2V0RGltZW5zaW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOnZpZGVvLndpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQ6dmlkZW8uaGVpZ2h0XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhciBjb3B5VG9Db250ZXh0PWZ1bmN0aW9uKGNvbnRleHQpe1xyXG4gICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKHZpZGVvLCAwLDApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgd2FpdDp3YWl0Q2FtZXJhLFxyXG4gICAgICAgIGNvcHlUb0NvbnRleHQ6Y29weVRvQ29udGV4dCxcclxuICAgICAgICBnZXREaW1lbnNpb25zOmdldERpbWVuc2lvbnNcclxuICAgIH1cclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUkRldGVjdG9yJywgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlKHNvdXJjZUNhbnZhcyl7XHJcbiAgICAgICB2YXIgSlNBUlJhc3RlciA9IG5ldyBOeUFSUmdiUmFzdGVyX0NhbnZhczJEKHNvdXJjZUNhbnZhcyk7XHJcbiAgICAgICAgdmFyIEpTQVJQYXJhbWV0ZXJzID0gbmV3IEZMQVJQYXJhbShzb3VyY2VDYW52YXMud2lkdGgsIHNvdXJjZUNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIHZhciBKU0FSRGV0ZWN0b3IgPSBuZXcgRkxBUk11bHRpSWRNYXJrZXJEZXRlY3RvcihKU0FSUGFyYW1ldGVycywgMTIwKTtcclxuICAgICAgICBKU0FSRGV0ZWN0b3Iuc2V0Q29udGludWVNb2RlKHRydWUpO1xyXG5cclxuICAgICAgICB2YXIgZ2V0TWFya2VyTnVtYmVyID0gZnVuY3Rpb24oaWR4KSB7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gSlNBUkRldGVjdG9yLmdldElkTWFya2VyRGF0YShpZHgpO1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5wYWNrZXRMZW5ndGggPiA0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0PTA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5wYWNrZXRMZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCBkYXRhLmdldFBhY2tldERhdGEoaSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZ2V0VHJhbnNmb3JtTWF0cml4ID0gZnVuY3Rpb24oaWR4KSB7XHJcbiAgICAgICAgICAgIHZhciBtYXQgPSBuZXcgTnlBUlRyYW5zTWF0UmVzdWx0KCk7XHJcbiAgICAgICAgICAgIEpTQVJEZXRlY3Rvci5nZXRUcmFuc2Zvcm1NYXRyaXgoaWR4LCBtYXQpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNtID0gbmV3IEZsb2F0MzJBcnJheSgxNik7XHJcbiAgICAgICAgICAgIGNtWzBdID0gbWF0Lm0wMDtcclxuICAgICAgICAgICAgY21bMV0gPSAtbWF0Lm0xMDtcclxuICAgICAgICAgICAgY21bMl0gPSBtYXQubTIwO1xyXG4gICAgICAgICAgICBjbVszXSA9IDA7XHJcbiAgICAgICAgICAgIGNtWzRdID0gbWF0Lm0wMTtcclxuICAgICAgICAgICAgY21bNV0gPSAtbWF0Lm0xMTtcclxuICAgICAgICAgICAgY21bNl0gPSBtYXQubTIxO1xyXG4gICAgICAgICAgICBjbVs3XSA9IDA7XHJcbiAgICAgICAgICAgIGNtWzhdID0gLW1hdC5tMDI7XHJcbiAgICAgICAgICAgIGNtWzldID0gbWF0Lm0xMjtcclxuICAgICAgICAgICAgY21bMTBdID0gLW1hdC5tMjI7XHJcbiAgICAgICAgICAgIGNtWzExXSA9IDA7XHJcbiAgICAgICAgICAgIGNtWzEyXSA9IG1hdC5tMDM7XHJcbiAgICAgICAgICAgIGNtWzEzXSA9IC1tYXQubTEzO1xyXG4gICAgICAgICAgICBjbVsxNF0gPSBtYXQubTIzO1xyXG4gICAgICAgICAgICBjbVsxNV0gPSAxO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGdldENhbWVyYU1hdHJpeCA9IGZ1bmN0aW9uKHpOZWFyLCB6RmFyKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgRmxvYXQzMkFycmF5KDE2KTtcclxuICAgICAgICAgICAgSlNBUlBhcmFtZXRlcnMuY29weUNhbWVyYU1hdHJpeChyZXN1bHQsIHpOZWFyLCB6RmFyKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBwZXJzaXN0VGltZSA9IDE7XHJcbiAgICAgICAgdmFyIG5ld01hcmtlciA9IGZ1bmN0aW9uKGlkLCBtYXRyaXgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGlkOiBpZCxcclxuICAgICAgICAgICAgICAgIG1hdHJpeDogbWF0cml4LFxyXG4gICAgICAgICAgICAgICAgYWdlOiBwZXJzaXN0VGltZSxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIG1hcmtlcnMgPSB7fTtcclxuICAgICAgICB2YXIgZGV0ZWN0ID0gZnVuY3Rpb24oIG9uQ3JlYXRlLCBvblVwZGF0ZSwgb25EZXN0cm95ICkge1xyXG4gICAgICAgICAgICB2YXIgbWFya2VyQ291bnQgPSBKU0FSRGV0ZWN0b3IuZGV0ZWN0TWFya2VyTGl0ZShKU0FSUmFzdGVyLCA3MCk7IFxyXG4gICAgICAgICAgICBmb3IoIHZhciBpbmRleCA9IDA7IGluZGV4IDwgbWFya2VyQ291bnQ7IGluZGV4KysgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBnZXRNYXJrZXJOdW1iZXIoaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNbaWRdO1xyXG4gICAgICAgICAgICAgICAgaWYoIG1hcmtlciA9PT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlciA9IG5ld01hcmtlcihpZCwgZ2V0VHJhbnNmb3JtTWF0cml4KGluZGV4KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2Vyc1tpZF0gPSBtYXJrZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgb25DcmVhdGUoIG1hcmtlciApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLm1hdHJpeCA9IGdldFRyYW5zZm9ybU1hdHJpeChpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLmFnZSA9IHBlcnNpc3RUaW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIG9uVXBkYXRlKCBtYXJrZXIgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yKCB2YXIgaWQgaW4gbWFya2VycyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXJrZXIgPSBtYXJrZXJzW2lkXTtcclxuICAgICAgICAgICAgICAgIGlmKCBtYXJrZXIgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIG1hcmtlci5hZ2UtLSA9PSAwICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkRlc3Ryb3koIG1hcmtlciApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbWFya2Vyc1tpZF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICBkZXRlY3Q6IGRldGVjdCxcclxuICAgICAgICAgICAgZ2V0Q2FtZXJhTWF0cml4OiBnZXRDYW1lcmFNYXRyaXhcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgY3JlYXRlOmNyZWF0ZVxyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSJywgZnVuY3Rpb24oQVJDYW1lcmEsIEFSRGV0ZWN0b3IsIEFSM0QsIEFSTWFya2VyKSB7XHJcblxyXG4gICAgdmFyIGNhbnZhcywgY29udGV4dCwgZGV0ZWN0b3IsIHZpZXcsIGFjdGlvbnM7XHJcbiAgICB2YXIgaW5pdD1mdW5jdGlvbihnbENhbnZhcywgbWFya2VyX2FjdGlvbnMpe1xyXG5cclxuICAgICAgICBtYXJrZXJfYWN0aW9ucz1tYXJrZXJfYWN0aW9ucyB8fHt9XHJcbiAgICAgICAgYWN0aW9ucz17fTsgXHJcblxyXG4gICAgICAgIGNhbnZhcz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xyXG4gICAgICAgIHZhciBjYW1lcmFEaW1lbnNpb25zPUFSQ2FtZXJhLmdldERpbWVuc2lvbnMoKTtcclxuXHJcbiAgICAgICAgY2FudmFzLndpZHRoID0gY2FtZXJhRGltZW5zaW9ucy53aWR0aDtcclxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gY2FtZXJhRGltZW5zaW9ucy5oZWlnaHQ7XHJcblxyXG4gICAgICAgIGNvbnRleHQ9Y2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbiAgICAgICAgZGV0ZWN0b3I9QVJEZXRlY3Rvci5jcmVhdGUoY2FudmFzKTtcclxuXHJcbiAgICAgICAgdmlldz1BUjNELmNyZWF0ZShnbENhbnZhcywgY2FtZXJhRGltZW5zaW9ucywgY2FudmFzKTtcclxuXHJcbiAgICAgICAgYWN0aW9ucy5vbkNyZWF0ZT1BUk1hcmtlci5QcmltaXRpdmUodmlldywgbWFya2VyX2FjdGlvbnMub25DcmVhdGV8fEFSTWFya2VyLm9uQ3JlYXRlKTtcclxuICAgICAgICBhY3Rpb25zLm9uVXBkYXRlPUFSTWFya2VyLlByaW1pdGl2ZSh2aWV3LCBtYXJrZXJfYWN0aW9ucy5vblVwZGF0ZXx8QVJNYXJrZXIub25VcGRhdGUpO1xyXG4gICAgICAgIGFjdGlvbnMub25EZXN0cm95PUFSTWFya2VyLlByaW1pdGl2ZSh2aWV3LCBtYXJrZXJfYWN0aW9ucy5vbkRlc3Ryb3l8fEFSTWFya2VyLm9uRGVzdHJveSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHZhciB0aWNrPWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgQVJDYW1lcmEuY29weVRvQ29udGV4dChjb250ZXh0KTtcclxuICAgICAgICBjYW52YXMuY2hhbmdlZD10cnVlO1xyXG5cclxuICAgICAgICBkZXRlY3Rvci5kZXRlY3QoYWN0aW9ucy5vbkNyZWF0ZSwgYWN0aW9ucy5vblVwZGF0ZSwgYWN0aW9ucy5vbkRlc3Ryb3kpO1xyXG5cclxuICAgICAgICB2aWV3LnVwZGF0ZSgpO1xyXG4gICAgICAgIHZpZXcucmVuZGVyKCk7XHJcblxyXG5cclxuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2spO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW5pdDppbml0LFxyXG4gICAgICAgIHRpY2s6dGlja1xyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSTWFya2VyJywgZnVuY3Rpb24oQVJPYmplY3QpIHtcclxuXHJcbiAgICB2YXIgb2JqZWN0cz17XHJcbiAgICAgICAgMTY6IEFST2JqZWN0LmNyZWF0ZSh7Y29sb3I6MHhDQzAwMDB9KSxcclxuICAgICAgICAzMjogQVJPYmplY3QuY3JlYXRlKHtjb2xvcjoweDAwQ0MwMH0pLFxyXG4gICAgICAgIDY0OiBBUk9iamVjdC5jcmVhdGUoe2NvbG9yOjB4MDAwMENDfSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIG9uQ3JlYXRlPWZ1bmN0aW9uKHZpZXcsIG1hcmtlcil7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ3JlYXRlZFwiKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKG1hcmtlci5pZClcclxuXHJcbiAgICAgICAgdmFyIG9iamVjdD1vYmplY3RzW21hcmtlci5pZF07XHJcblxyXG5cclxuICAgICAgICBvYmplY3Qucm90YXRpb24ueCArPSAwLjE7XHJcbiAgICAgICAgb2JqZWN0LnJvdGF0aW9uLnkgKz0gMC4xO1xyXG4gICAgICAgIHZpZXcuYWRkKG9iamVjdCk7XHJcblxyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG9uVXBkYXRlPWZ1bmN0aW9uKHZpZXcsIG1hcmtlcil7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRlXCIpXHJcbiAgICAgICAgY29uc29sZS5sb2cobWFya2VyLmlkKVxyXG5cclxuICAgICAgICB2YXIgb2JqZWN0PW9iamVjdHNbbWFya2VyLmlkXTtcclxuXHJcbiAgICAgICAgb2JqZWN0LnJvdGF0aW9uLnggKz0gMC4xO1xyXG4gICAgICAgIG9iamVjdC5yb3RhdGlvbi55ICs9IDAuMTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG9uRGVzdHJveT1mdW5jdGlvbih2aWV3LCBtYXJrZXIpe1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcInJlbW92ZVwiKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKG1hcmtlci5pZClcclxuXHJcbiAgICAgICAgdmFyIG9iamVjdD1vYmplY3RzW21hcmtlci5pZF07XHJcbiAgICAgICAgdmlldy5yZW1vdmUob2JqZWN0KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIFByaW1pdGl2ZT1mdW5jdGlvbih2aWV3LCBjYil7XHJcbiAgICAgICAgY29uc29sZS5sb2coY2IpXHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG1hcmtlcil7XHJcbiAgICAgICAgICAgIGNiKHZpZXcsIG1hcmtlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgUHJpbWl0aXZlOlByaW1pdGl2ZSxcclxuICAgICAgICBvbkNyZWF0ZTpvbkNyZWF0ZSxcclxuICAgICAgICBvblVwZGF0ZTpvblVwZGF0ZSxcclxuICAgICAgICBvbkRlc3Ryb3k6b25EZXN0cm95XHJcbiAgICB9XHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUk9iamVjdCcsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lcigpIHtcclxuICAgICAgICB2YXIgbW9kZWwgPSBuZXcgVEhSRUUuT2JqZWN0M0QoKTtcclxuICAgICAgIFxyXG4gICAgICAgIHJldHVybiBtb2RlbDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjcmVhdGVDdWJlKGNvbG9yKSB7XHJcbiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KCAxLCAxLCAxICk7XHJcbiAgICAgICAgdmFyIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBjb2xvcn0gKTtcclxuICAgICAgICB2YXIgY3ViZSA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcclxuICAgICAgICBjdWJlLnBvc2l0aW9uLno9LTU7XHJcbiAgICAgICAgcmV0dXJuIGN1YmU7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlTWFya2VyT2JqZWN0KHBhcmFtcykge1xyXG5cclxuICAgICAgICByZXR1cm4gY3JlYXRlQ3ViZShwYXJhbXMuY29sb3IpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNyZWF0ZTpjcmVhdGVNYXJrZXJPYmplY3RcclxuICAgIH1cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSVXRpbHMnLCBmdW5jdGlvbigkaW9uaWNQbGF0Zm9ybSkge1xyXG5cclxuICAgIHZhciBzaXplPWZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICAgICAgICBlbGVtLndpZHRoPXdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICBlbGVtLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzaXplOnNpemUsIFxyXG4gICAgICAgIHNldFZpZGVvU2l6ZTpmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgc2l6ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8nKSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcbiJdfQ==
