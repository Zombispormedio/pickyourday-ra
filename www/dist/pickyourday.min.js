var app=angular.module("ar-toolkit",["ionic"]);angular.module("ar-toolkit").run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("ar-toolkit").directive("arView",["ARUtils","ARCamera","AR",function(e,n,t){return{restrict:"A",link:function(e,t,r){t[0];n.wait(function(){})}}}]),angular.module("ar-toolkit").factory("AR3D",function(){var e=function(e){function n(){o.needsUpdate=!0}var t=new THREE.Camera,r=new THREE.Scene,a=new THREE.PlaneGeometry(2,2,0),o=new THREE.Texture(e);o.minFilter=THREE.LinearFilter;var i=new THREE.MeshBasicMaterial({map:o,depthTest:!1,depthWrite:!1}),c=new THREE.Mesh(a,i);return r.add(c),{camera:t,scene:r,update:n}},n=function(){function e(e){t.add(e)}function n(e){t.remove(e)}var t=new THREE.Scene,r=new THREE.Camera;return{scene:t,camera:r,add:e,remove:n}},t=function(t,r,a){function o(){d.render(l.scene,l.camera),d.render(w.scene,w.camera)}function i(){l.update()}function c(e){w.add(e.model)}function u(e){w.remove(e.model)}var d=new THREE.WebGLRenderer({canvas:t});d.setSize(r.width,r.height),d.autoClear=!1;var l=new e(a),w=new n,s=new THREE.SpotLight(16777215);return s.position.set(0,0,9e3),s.lookAt(new THREE.Vector3(0,0,0)),w.scene.add(s),{add:c,remove:u,update:i,render:o,glCanvas:t}};return{create:t}}),angular.module("ar-toolkit").factory("ARCamera",["ARUtils",function(e){var n=document.getElementById("video"),t=function(e,n,t){var r=void 0;return navigator.getUserMedia?r=navigator.getUserMedia(e,n,t):navigator.webkitGetUserMedia&&(r=navigator.webkitGetUserMedia(e,n,t)),r},r=function(e){return function(t){var r=window.URL||window.webkitURL;n.src=r.createObjectURL(t),n.play(),e()}},a=function(e){console.log("An error occured! "+e)},o=function(e){t({video:!0,audio:!1},r(e),a)},i=function(){return{width:n.width,height:n.height}},c=function(e){e.drawImage(n,0,0)};return{wait:o,copyToContext:c,getDimensions:i}}]),angular.module("ar-toolkit").factory("ARDetector",function(){function e(){return{}}return{create:e}}),angular.module("ar-toolkit").factory("AR",["ARCamera","ARDetector","AR3D",function(e,n,t){var r,a,o,i=function(n){r=document.createElement("canvas");var i=e.getDimensions();r.width=i.width,r.height=i.height,a=r.getContext("2d"),o=t.create(n,i,r)},c=function(){e.copyToContext(a),r.changed=!0,o.update(),o.render(),window.requestAnimationFrame(c)};return{init:i,tick:c}}]),angular.module("ar-toolkit").factory("ARUtils",function(){return{size:function(e){e.width=window.innerWidth,e.height=window.innerHeight}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZy9ib290LmpzIiwiY29tcG9uZW50cy9kaXJlY3RpdmVzL2FyX3ZpZXdfZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfM2RfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2NhbWVyYV9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfZGV0ZWN0b3JfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2ZhY3RvcnkuanMiLCJjb21wb25lbnRzL2ZhY3Rvcmllcy9hcl91dGlsc19mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJydW4iLCIkaW9uaWNQbGF0Zm9ybSIsInJlYWR5Iiwid2luZG93IiwiY29yZG92YSIsInBsdWdpbnMiLCJLZXlib2FyZCIsImhpZGVLZXlib2FyZEFjY2Vzc29yeUJhciIsImRpc2FibGVTY3JvbGwiLCJTdGF0dXNCYXIiLCJzdHlsZURlZmF1bHQiLCJkaXJlY3RpdmUiLCJBUlV0aWxzIiwiQVJDYW1lcmEiLCJBUiIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwidEVsZW1lbnQiLCJhdHRycyIsIndhaXQiLCJmYWN0b3J5IiwiUmVhbGl0eSIsInNvdXJjZUNhbnZhcyIsInVwZGF0ZSIsInRleHR1cmUiLCJuZWVkc1VwZGF0ZSIsImNhbWVyYSIsIlRIUkVFIiwiQ2FtZXJhIiwic2NlbmUiLCJTY2VuZSIsImdlb21ldHJ5IiwiUGxhbmVHZW9tZXRyeSIsIlRleHR1cmUiLCJtaW5GaWx0ZXIiLCJMaW5lYXJGaWx0ZXIiLCJtYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwibWFwIiwiZGVwdGhUZXN0IiwiZGVwdGhXcml0ZSIsIm1lc2giLCJNZXNoIiwiYWRkIiwib2JqZWN0IiwicmVtb3ZlIiwiY3JlYXRlIiwiZ2xDYW52YXMiLCJkaW1lbnNpb25zIiwicmVuZGVyIiwicmVuZGVyZXIiLCJyZWFsaXR5IiwidmlydHVhbCIsIm1vZGVsIiwiV2ViR0xSZW5kZXJlciIsImNhbnZhcyIsInNldFNpemUiLCJ3aWR0aCIsImhlaWdodCIsImF1dG9DbGVhciIsImxpZ2h0IiwiU3BvdExpZ2h0IiwicG9zaXRpb24iLCJzZXQiLCJsb29rQXQiLCJWZWN0b3IzIiwidmlkZW8iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0TWVkaWFDYXB0dXJlIiwidCIsIm9uc3VjY2VzcyIsIm9uZXJyb3IiLCJyZXN1bHQiLCJ1bmRlZmluZWQiLCJuYXZpZ2F0b3IiLCJnZXRVc2VyTWVkaWEiLCJ3ZWJraXRHZXRVc2VyTWVkaWEiLCJvblN1Y2Nlc3MiLCJjYiIsInN0cmVhbSIsInZlbmRvclVSTCIsIlVSTCIsIndlYmtpdFVSTCIsInNyYyIsImNyZWF0ZU9iamVjdFVSTCIsInBsYXkiLCJvbkVycm9yIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIndhaXRDYW1lcmEiLCJjYWxsYmFjayIsImF1ZGlvIiwiZ2V0RGltZW5zaW9ucyIsImNvcHlUb0NvbnRleHQiLCJjb250ZXh0IiwiZHJhd0ltYWdlIiwiQVJEZXRlY3RvciIsIkFSM0QiLCJ2aWV3IiwiaW5pdCIsImNyZWF0ZUVsZW1lbnQiLCJjYW1lcmFEaW1lbnNpb25zIiwiZ2V0Q29udGV4dCIsInRpY2siLCJjaGFuZ2VkIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwic2l6ZSIsImVsZW0iLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsY0FBQSxTQ0FBRCxTQUFBQyxPQUFBLGNBQ0FDLEtBQUEsaUJBQUEsU0FBQUMsR0FDQUEsRUFBQUMsTUFBQSxXQUNBQyxPQUFBQyxTQUFBRCxPQUFBQyxRQUFBQyxRQUFBQyxXQUdBRixRQUFBQyxRQUFBQyxTQUFBQywwQkFBQSxHQUtBSCxRQUFBQyxRQUFBQyxTQUFBRSxlQUFBLElBRUFMLE9BQUFNLFdBQ0FBLFVBQUFDLG9CQ2RBWixRQUFBQyxP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QUFBUSxFQUFBUixTQUlBcUMsRUFBQSxTQUFBQyxHQUNBQSxFQUFBQyxVQUFBL0IsRUFBQSxFQUFBLEdBR0EsUUFDQS9DLEtBQUF3RSxFQUNBSSxjQUFBQSxFQUNBRCxjQUFBQSxNQ2xEQWpHLFFBQUFDLE9BQUEsY0FDQXNCLFFBQUEsYUFBQSxXQUVBLFFBQUEwQixLQUNBLFNBR0EsT0FDQUEsT0FBQUEsS0NSQWpELFFBQUFDLE9BQUEsY0FDQXNCLFFBQUEsTUFBQSxXQUFBLGFBQUEsT0FBQSxTQUFBUixFQUFBc0YsRUFBQUMsR0FFQSxHQUFBNUMsR0FBQXlDLEVBQUFJLEVBQ0FDLEVBQUEsU0FBQXRELEdBRUFRLEVBQUFZLFNBQUFtQyxjQUFBLFNBQ0EsSUFBQUMsR0FBQTNGLEVBQUFrRixlQUNBdkMsR0FBQUUsTUFBQThDLEVBQUE5QyxNQUNBRixFQUFBRyxPQUFBNkMsRUFBQTdDLE9BRUFzQyxFQUFBekMsRUFBQWlELFdBQUEsTUFJQUosRUFBQUQsRUFBQXJELE9BQUFDLEVBQUF3RCxFQUFBaEQsSUFJQWtELEVBQUEsV0FDQTdGLEVBQUFtRixjQUFBQyxHQUNBekMsRUFBQW1ELFNBQUEsRUFFQU4sRUFBQTdFLFNBQ0E2RSxFQUFBbkQsU0FHQS9DLE9BQUF5RyxzQkFBQUYsR0FHQSxRQUNBSixLQUFBQSxFQUNBSSxLQUFBQSxNQ2hDQTVHLFFBQUFDLE9BQUEsY0FDQXNCLFFBQUEsVUFBQSxXQUVBLE9BQ0F3RixLQUFBLFNBQUFDLEdBQ0FBLEVBQUFwRCxNQUFBdkQsT0FBQTRHLFdBQ0FELEVBQUFuRCxPQUFBeEQsT0FBQTZHIiwiZmlsZSI6InBpY2t5b3VyZGF5Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHA9YW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnLCBbJ2lvbmljJ10pXG5cblxuIiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4ucnVuKGZ1bmN0aW9uKCRpb25pY1BsYXRmb3JtKSB7XHJcbiAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XHJcbiAgICBpZih3aW5kb3cuY29yZG92YSAmJiB3aW5kb3cuY29yZG92YS5wbHVnaW5zLktleWJvYXJkKSB7XHJcbiAgICAgIC8vIEhpZGUgdGhlIGFjY2Vzc29yeSBiYXIgYnkgZGVmYXVsdCAocmVtb3ZlIHRoaXMgdG8gc2hvdyB0aGUgYWNjZXNzb3J5IGJhciBhYm92ZSB0aGUga2V5Ym9hcmRcclxuICAgICAgLy8gZm9yIGZvcm0gaW5wdXRzKVxyXG4gICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyKHRydWUpO1xyXG5cclxuICAgICAgLy8gRG9uJ3QgcmVtb3ZlIHRoaXMgbGluZSB1bmxlc3MgeW91IGtub3cgd2hhdCB5b3UgYXJlIGRvaW5nLiBJdCBzdG9wcyB0aGUgdmlld3BvcnRcclxuICAgICAgLy8gZnJvbSBzbmFwcGluZyB3aGVuIHRleHQgaW5wdXRzIGFyZSBmb2N1c2VkLiBJb25pYyBoYW5kbGVzIHRoaXMgaW50ZXJuYWxseSBmb3JcclxuICAgICAgLy8gYSBtdWNoIG5pY2VyIGtleWJvYXJkIGV4cGVyaWVuY2UuXHJcbiAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5kaXNhYmxlU2Nyb2xsKHRydWUpO1xyXG4gICAgfVxyXG4gICAgaWYod2luZG93LlN0YXR1c0Jhcikge1xyXG4gICAgICBTdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgICBcclxuICAgIFxyXG59KSIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5kaXJlY3RpdmUoJ2FyVmlldycsIGZ1bmN0aW9uKEFSVXRpbHMsIEFSQ2FtZXJhLCBBUikge1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICBsaW5rOmZ1bmN0aW9uKHNjb3BlLCB0RWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICB2YXIgZWxlbT10RWxlbWVudFswXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEFSQ2FtZXJhLndhaXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIC8qQVIuaW5pdChlbGVtKTtcclxuICAgICAgICAgICAgICAgIEFSLnRpY2soKTsqL1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVIzRCcsIGZ1bmN0aW9uKCkge1xyXG5cclxuXHJcbiAgICB2YXIgUmVhbGl0eT1mdW5jdGlvbihzb3VyY2VDYW52YXMpe1xyXG5cclxuICAgICAgICB2YXIgY2FtZXJhPSBuZXcgVEhSRUUuQ2FtZXJhKCk7XHJcbiAgICAgICAgdmFyIHNjZW5lPSBuZXcgVEhSRUUuU2NlbmUoKTtcclxuXHJcbiAgICAgICAgdmFyIGdlb21ldHJ5PSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgyLDIsMCk7XHJcbiAgICAgICAgdmFyIHRleHR1cmU9bmV3IFRIUkVFLlRleHR1cmUoc291cmNlQ2FudmFzKTtcclxuICAgICAgICB0ZXh0dXJlLm1pbkZpbHRlciA9IFRIUkVFLkxpbmVhckZpbHRlcjtcclxuICAgICAgICB2YXIgbWF0ZXJpYWw9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDp0ZXh0dXJlLFxyXG4gICAgICAgICAgICBkZXB0aFRlc3Q6ZmFsc2UsXHJcbiAgICAgICAgICAgIGRlcHRoV3JpdGU6ZmFsc2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIG1lc2g9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XHJcbiAgICAgICAgc2NlbmUuYWRkKG1lc2gpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoKXtcclxuICAgICAgICAgICAgdGV4dHVyZS5uZWVkc1VwZGF0ZT10cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY2FtZXJhOiBjYW1lcmEsXHJcbiAgICAgICAgICAgIHNjZW5lOiBzY2VuZSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsIFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIFNjZW5lPWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIHNjZW5lPW5ldyBUSFJFRS5TY2VuZSgpO1xyXG4gICAgICAgIHZhciBjYW1lcmE9bmV3IFRIUkVFLkNhbWVyYSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGQob2JqZWN0KXtcclxuICAgICAgICAgICAgc2NlbmUuYWRkKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUob2JqZWN0KXtcclxuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHNjZW5lOnNjZW5lLFxyXG4gICAgICAgICAgICBjYW1lcmE6Y2FtZXJhLFxyXG4gICAgICAgICAgICBhZGQ6YWRkLFxyXG4gICAgICAgICAgICByZW1vdmU6cmVtb3ZlXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHZhciBjcmVhdGU9ZnVuY3Rpb24oZ2xDYW52YXMsIGRpbWVuc2lvbnMsIHNvdXJjZUNhbnZhcyl7XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJlcj1uZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7Y2FudmFzOmdsQ2FudmFzfSk7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZShkaW1lbnNpb25zLndpZHRoLCBkaW1lbnNpb25zLmhlaWdodCk7XHJcbiAgICAgICAgcmVuZGVyZXIuYXV0b0NsZWFyPWZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgcmVhbGl0eT0gbmV3IFJlYWxpdHkoc291cmNlQ2FudmFzKTtcclxuICAgICAgICB2YXIgdmlydHVhbD0gbmV3IFNjZW5lKCk7XHJcblxyXG4gICAgICAgIHZhciBsaWdodD1uZXcgVEhSRUUuU3BvdExpZ2h0KDB4ZmZmZmZmKTtcclxuICAgICAgICBsaWdodC5wb3NpdGlvbi5zZXQoMCwwLDkwMDApO1xyXG4gICAgICAgIGxpZ2h0Lmxvb2tBdChuZXcgVEhSRUUuVmVjdG9yMygwLDAsMCkpO1xyXG4gICAgICAgIHZpcnR1YWwuc2NlbmUuYWRkKGxpZ2h0KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCl7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcihyZWFsaXR5LnNjZW5lLCByZWFsaXR5LmNhbWVyYSk7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcih2aXJ0dWFsLnNjZW5lLCB2aXJ0dWFsLmNhbWVyYSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoKXtcclxuICAgICAgICAgICAgcmVhbGl0eS51cGRhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZChvYmplY3Qpe1xyXG4gICAgICAgICAgICB2aXJ0dWFsLmFkZChvYmplY3QubW9kZWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKG9iamVjdCl7XHJcbiAgICAgICAgICAgIHZpcnR1YWwucmVtb3ZlKG9iamVjdC5tb2RlbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhZGQ6IGFkZCxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgICAgICByZW5kZXI6IHJlbmRlcixcclxuICAgICAgICAgICAgZ2xDYW52YXM6IGdsQ2FudmFzXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNyZWF0ZTpjcmVhdGVcclxuICAgIH1cclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUkNhbWVyYScsIGZ1bmN0aW9uKCBBUlV0aWxzKSB7XHJcblxyXG4gICAgdmFyIHZpZGVvPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8nKTtcclxuXHJcblxyXG4gICAgdmFyIGdldE1lZGlhQ2FwdHVyZSA9IGZ1bmN0aW9uKHQsIG9uc3VjY2Vzcywgb25lcnJvcikge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKG5hdmlnYXRvci5nZXRVc2VyTWVkaWEpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbmF2aWdhdG9yLmdldFVzZXJNZWRpYSh0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKHQsIG9uc3VjY2Vzcywgb25lcnJvcik7XHJcbiAgICAgICAgfSBcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgb25TdWNjZXNzPWZ1bmN0aW9uKGNiKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc3RyZWFtKXtcclxuICAgICAgICAgICAgdmFyIHZlbmRvclVSTCA9IHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTDtcclxuICAgICAgICAgICAgdmlkZW8uc3JjID0gdmVuZG9yVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pO1xyXG4gICAgICAgICAgICB2aWRlby5wbGF5KCk7XHJcbiAgICAgICAgICAgIGNiKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIHZhciBvbkVycm9yPWZ1bmN0aW9uKGVycil7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJBbiBlcnJvciBvY2N1cmVkISBcIiArIGVycik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHZhciB3YWl0Q2FtZXJhPWZ1bmN0aW9uKGNhbGxiYWNrKXtcclxuXHJcbiAgICAgICAgZ2V0TWVkaWFDYXB0dXJlKHt2aWRlbzogdHJ1ZSxhdWRpbzogZmFsc2V9LCBvblN1Y2Nlc3MoY2FsbGJhY2spLCBvbkVycm9yKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGdldERpbWVuc2lvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aWR0aDp2aWRlby53aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0OnZpZGVvLmhlaWdodFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YXIgY29weVRvQ29udGV4dD1mdW5jdGlvbihjb250ZXh0KXtcclxuICAgICAgICBjb250ZXh0LmRyYXdJbWFnZSh2aWRlbywgMCwwKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHdhaXQ6d2FpdENhbWVyYSxcclxuICAgICAgICBjb3B5VG9Db250ZXh0OmNvcHlUb0NvbnRleHQsXHJcbiAgICAgICAgZ2V0RGltZW5zaW9uczpnZXREaW1lbnNpb25zXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJEZXRlY3RvcicsIGZ1bmN0aW9uKCkge1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBjcmVhdGUoKXtcclxuICAgICAgICByZXR1cm4ge307XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgY3JlYXRlOmNyZWF0ZVxyXG4gICAgfVxyXG4gICAgXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUicsIGZ1bmN0aW9uKEFSQ2FtZXJhLCBBUkRldGVjdG9yLCBBUjNEKSB7XHJcblxyXG4gICAgdmFyIGNhbnZhcywgY29udGV4dCwgZGV0ZWN0b3IsIHZpZXc7XHJcbiAgICB2YXIgaW5pdD1mdW5jdGlvbihnbENhbnZhcyl7XHJcblxyXG4gICAgICAgIGNhbnZhcz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xyXG4gICAgICAgIHZhciBjYW1lcmFEaW1lbnNpb25zPUFSQ2FtZXJhLmdldERpbWVuc2lvbnMoKTtcclxuICAgICAgICBjYW52YXMud2lkdGggPSBjYW1lcmFEaW1lbnNpb25zLndpZHRoO1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBjYW1lcmFEaW1lbnNpb25zLmhlaWdodDtcclxuXHJcbiAgICAgICAgY29udGV4dD1jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vZGV0ZWN0b3I9QVJEZXRlY3Rvci5jcmVhdGUoY2FudmFzKTtcclxuICAgICAgICBcclxuICAgICAgICB2aWV3PUFSM0QuY3JlYXRlKGdsQ2FudmFzLCBjYW1lcmFEaW1lbnNpb25zLCBjYW52YXMpO1xyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgdmFyIHRpY2s9ZnVuY3Rpb24oKXtcclxuICAgICAgICBBUkNhbWVyYS5jb3B5VG9Db250ZXh0KGNvbnRleHQpO1xyXG4gICAgICAgIGNhbnZhcy5jaGFuZ2VkPXRydWU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmlldy51cGRhdGUoKTtcclxuICAgICAgICB2aWV3LnJlbmRlcigpO1xyXG4gICAgICAgIFxyXG4gICAgXHJcbiAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGljayk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0OmluaXQsXHJcbiAgICAgICAgdGljazp0aWNrXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJVdGlscycsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgc2l6ZTpmdW5jdGlvbihlbGVtKXtcclxuICAgICAgICAgICAgZWxlbS53aWR0aD13aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICAgICAgZWxlbS5oZWlnaHQ9d2luZG93LmlubmVySGVpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7Il19
