var app=angular.module("ar-toolkit",["ionic"]);angular.module("ar-toolkit").run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("ar-toolkit").directive("arView",["ARUtils","ARCamera","AR",function(e,t,n){return{restrict:"A",link:function(r,a,i){var o=a[0];e.size(o),t.wait(function(){n.init(o),n.tick()})}}}]),angular.module("ar-toolkit").factory("AR3D",function(){var e=function(e){function t(){i.needsUpdate=!0}var n=new THREE.Camera,r=new THREE.Scene,a=new THREE.PlaneGeometry(2,2,0),i=new THREE.Texture(e);i.generateMipmaps=!1,i.minFilter=THREE.NearestFilter,i.magFilter=THREE.NearestFilter,i.wrapS=i.wrapT=THREE.ClampToEdgeWrapping;var o=new THREE.MeshBasicMaterial({map:i,depthTest:!1,depthWrite:!1}),c=new THREE.Mesh(a,o);return r.add(c),{camera:n,scene:r,update:t}},t=function(){function e(e){n.add(e)}function t(e){n.remove(e)}var n=new THREE.Scene,r=new THREE.Camera;return{scene:n,camera:r,add:e,remove:t}},n=function(n,r,a){function i(){u.render(l.scene,l.camera),u.render(w.scene,w.camera)}function o(){l.update()}function c(e){w.add(e.model)}function d(e){w.remove(e.model)}var u=new THREE.WebGLRenderer({canvas:n});u.setSize(r.width,r.height),u.autoClear=!1;var l=new e(a),w=new t,s=new THREE.SpotLight(16777215);return s.position.set(0,0,9e3),s.lookAt(new THREE.Vector3(0,0,0)),w.scene.add(s),{add:c,remove:d,update:o,render:i,glCanvas:n}};return{create:n}}),angular.module("ar-toolkit").factory("ARCamera",["ARUtils",function(e){var t=document.getElementById("video");e.size(t);var n=function(e,t,n){var r=void 0;return navigator.getUserMedia?r=navigator.getUserMedia(e,t,n):navigator.webkitGetUserMedia&&(r=navigator.webkitGetUserMedia(e,t,n)),r},r=function(e){return function(n){var r=window.URL||window.webkitURL;t.src=r.createObjectURL(n),t.play(),e()}},a=function(e){console.log("An error occured! "+e)},i=function(e){n({video:!0,audio:!1},r(e),a)},o=function(){return{width:t.width,height:t.height}},c=function(e){e.drawImage(t,0,0)};return{wait:i,copyToContext:c,getDimensions:o}}]),angular.module("ar-toolkit").factory("ARDetector",function(){function e(){return{}}return{create:e}}),angular.module("ar-toolkit").factory("AR",["ARCamera","ARDetector","AR3D",function(e,t,n){var r,a,i,o=function(t){r=document.createElement("canvas");var o=e.getDimensions();r.width=o.width,r.height=o.height,a=r.getContext("2d"),i=n.create(t,o,r)},c=function(){e.copyToContext(a),r.changed=!0,i.update(),i.render(),window.requestAnimationFrame(c)};return{init:o,tick:c}}]),angular.module("ar-toolkit").factory("ARUtils",["$ionicPlatform",function(e){return{size:function(t){t.width=window.innerWidth,t.height=window.innerHeight,e.ready(function(){t.width=window.innerWidth,t.height=window.innerHeight})}}}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZy9ib290LmpzIiwiY29tcG9uZW50cy9kaXJlY3RpdmVzL2FyX3ZpZXdfZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfM2RfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2NhbWVyYV9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfZGV0ZWN0b3JfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2ZhY3RvcnkuanMiLCJjb21wb25lbnRzL2ZhY3Rvcmllcy9hcl91dGlsc19mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJydW4iLCIkaW9uaWNQbGF0Zm9ybSIsInJlYWR5Iiwid2luZG93IiwiY29yZG92YSIsInBsdWdpbnMiLCJLZXlib2FyZCIsImhpZGVLZXlib2FyZEFjY2Vzc29yeUJhciIsImRpc2FibGVTY3JvbGwiLCJTdGF0dXNCYXIiLCJzdHlsZURlZmF1bHQiLCJkaXJlY3RpdmUiLCJBUlV0aWxzIiwiQVJDYW1lcmEiLCJBUiIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwidEVsZW1lbnQiLCJhdHRycyIsImVsZW0iLCJzaXplIiwid2FpdCIsImluaXQiLCJ0aWNrIiwiZmFjdG9yeSIsIlJlYWxpdHkiLCJzb3VyY2VDYW52YXMiLCJ1cGRhdGUiLCJ0ZXh0dXJlIiwibmVlZHNVcGRhdGUiLCJjYW1lcmEiLCJUSFJFRSIsIkNhbWVyYSIsInNjZW5lIiwiU2NlbmUiLCJnZW9tZXRyeSIsIlBsYW5lR2VvbWV0cnkiLCJUZXh0dXJlIiwiZ2VuZXJhdGVNaXBtYXBzIiwibWluRmlsdGVyIiwiTmVhcmVzdEZpbHRlciIsIm1hZ0ZpbHRlciIsIndyYXBTIiwid3JhcFQiLCJDbGFtcFRvRWRnZVdyYXBwaW5nIiwibWF0ZXJpYWwiLCJNZXNoQmFzaWNNYXRlcmlhbCIsIm1hcCIsImRlcHRoVGVzdCIsImRlcHRoV3JpdGUiLCJtZXNoIiwiTWVzaCIsImFkZCIsIm9iamVjdCIsInJlbW92ZSIsImNyZWF0ZSIsImdsQ2FudmFzIiwiZGltZW5zaW9ucyIsInJlbmRlciIsInJlbmRlcmVyIiwicmVhbGl0eSIsInZpcnR1YWwiLCJtb2RlbCIsIldlYkdMUmVuZGVyZXIiLCJjYW52YXMiLCJzZXRTaXplIiwid2lkdGgiLCJoZWlnaHQiLCJhdXRvQ2xlYXIiLCJsaWdodCIsIlNwb3RMaWdodCIsInBvc2l0aW9uIiwic2V0IiwibG9va0F0IiwiVmVjdG9yMyIsInZpZGVvIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldE1lZGlhQ2FwdHVyZSIsInQiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwicmVzdWx0IiwidW5kZWZpbmVkIiwibmF2aWdhdG9yIiwiZ2V0VXNlck1lZGlhIiwid2Via2l0R2V0VXNlck1lZGlhIiwib25TdWNjZXNzIiwiY2IiLCJzdHJlYW0iLCJ2ZW5kb3JVUkwiLCJVUkwiLCJ3ZWJraXRVUkwiLCJzcmMiLCJjcmVhdGVPYmplY3RVUkwiLCJwbGF5Iiwib25FcnJvciIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ3YWl0Q2FtZXJhIiwiY2FsbGJhY2siLCJhdWRpbyIsImdldERpbWVuc2lvbnMiLCJjb3B5VG9Db250ZXh0IiwiY29udGV4dCIsImRyYXdJbWFnZSIsIkFSRGV0ZWN0b3IiLCJBUjNEIiwidmlldyIsImNyZWF0ZUVsZW1lbnQiLCJjYW1lcmFEaW1lbnNpb25zIiwiZ2V0Q29udGV4dCIsImNoYW5nZWQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsY0FBQSxTQ0FBRCxTQUFBQyxPQUFBLGNBQ0FDLEtBQUEsaUJBQUEsU0FBQUMsR0FDQUEsRUFBQUMsTUFBQSxXQUNBQyxPQUFBQyxTQUFBRCxPQUFBQyxRQUFBQyxRQUFBQyxXQUdBRixRQUFBQyxRQUFBQyxTQUFBQywwQkFB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LEVBQUErQyxNQUFBaEUsT0FBQWlILFdBQ0FoRyxFQUFBZ0QsT0FBQWpFLE9BQUFrSCxZQUVBcEgsRUFBQUMsTUFBQSxXQUNBa0IsRUFBQStDLE1BQUFoRSxPQUFBaUgsV0FDQWhHLEVBQUFnRCxPQUFBakUsT0FBQWtIIiwiZmlsZSI6InBpY2t5b3VyZGF5Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHA9YW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnLCBbJ2lvbmljJ10pXG5cblxuIiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4ucnVuKGZ1bmN0aW9uKCRpb25pY1BsYXRmb3JtKSB7XHJcbiAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XHJcbiAgICBpZih3aW5kb3cuY29yZG92YSAmJiB3aW5kb3cuY29yZG92YS5wbHVnaW5zLktleWJvYXJkKSB7XHJcbiAgICAgIC8vIEhpZGUgdGhlIGFjY2Vzc29yeSBiYXIgYnkgZGVmYXVsdCAocmVtb3ZlIHRoaXMgdG8gc2hvdyB0aGUgYWNjZXNzb3J5IGJhciBhYm92ZSB0aGUga2V5Ym9hcmRcclxuICAgICAgLy8gZm9yIGZvcm0gaW5wdXRzKVxyXG4gICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyKHRydWUpO1xyXG5cclxuICAgICAgLy8gRG9uJ3QgcmVtb3ZlIHRoaXMgbGluZSB1bmxlc3MgeW91IGtub3cgd2hhdCB5b3UgYXJlIGRvaW5nLiBJdCBzdG9wcyB0aGUgdmlld3BvcnRcclxuICAgICAgLy8gZnJvbSBzbmFwcGluZyB3aGVuIHRleHQgaW5wdXRzIGFyZSBmb2N1c2VkLiBJb25pYyBoYW5kbGVzIHRoaXMgaW50ZXJuYWxseSBmb3JcclxuICAgICAgLy8gYSBtdWNoIG5pY2VyIGtleWJvYXJkIGV4cGVyaWVuY2UuXHJcbiAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5kaXNhYmxlU2Nyb2xsKHRydWUpO1xyXG4gICAgfVxyXG4gICAgaWYod2luZG93LlN0YXR1c0Jhcikge1xyXG4gICAgICBTdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgICBcclxuICAgIFxyXG59KSIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5kaXJlY3RpdmUoJ2FyVmlldycsIGZ1bmN0aW9uKEFSVXRpbHMsIEFSQ2FtZXJhLCBBUikge1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICBsaW5rOmZ1bmN0aW9uKHNjb3BlLCB0RWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICB2YXIgZWxlbT10RWxlbWVudFswXTtcclxuICAgICAgICAgICAgICBBUlV0aWxzLnNpemUoZWxlbSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBBUkNhbWVyYS53YWl0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBBUi5pbml0KGVsZW0pO1xyXG4gICAgICAgICAgICAgICAgQVIudGljaygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVIzRCcsIGZ1bmN0aW9uKCkge1xyXG5cclxuXHJcbiAgICB2YXIgUmVhbGl0eT1mdW5jdGlvbihzb3VyY2VDYW52YXMpe1xyXG5cclxuICAgICAgICB2YXIgY2FtZXJhPSBuZXcgVEhSRUUuQ2FtZXJhKCk7XHJcbiAgICAgICAgdmFyIHNjZW5lPSBuZXcgVEhSRUUuU2NlbmUoKTtcclxuXHJcbiAgICAgICAgdmFyIGdlb21ldHJ5PSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgyLDIsMCk7XHJcbiAgICAgICAgdmFyIHRleHR1cmU9bmV3IFRIUkVFLlRleHR1cmUoc291cmNlQ2FudmFzKTtcclxuICAgICAgICB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlO1xyXG4gICAgICAgIHRleHR1cmUubWluRmlsdGVyID0gVEhSRUUuTmVhcmVzdEZpbHRlcjtcclxuICAgICAgICB0ZXh0dXJlLm1hZ0ZpbHRlciA9IFRIUkVFLk5lYXJlc3RGaWx0ZXI7XHJcbiAgICAgICAgdGV4dHVyZS53cmFwUyA9IHRleHR1cmUud3JhcFQgPVRIUkVFLkNsYW1wVG9FZGdlV3JhcHBpbmc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcblxyXG5cclxuICAgICAgICB2YXIgbWF0ZXJpYWw9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDp0ZXh0dXJlLFxyXG4gICAgICAgICAgICBkZXB0aFRlc3Q6ZmFsc2UsXHJcbiAgICAgICAgICAgIGRlcHRoV3JpdGU6ZmFsc2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIG1lc2g9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XHJcbiAgICAgICAgc2NlbmUuYWRkKG1lc2gpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoKXtcclxuICAgICAgICAgICAgdGV4dHVyZS5uZWVkc1VwZGF0ZT10cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY2FtZXJhOiBjYW1lcmEsXHJcbiAgICAgICAgICAgIHNjZW5lOiBzY2VuZSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsIFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIFNjZW5lPWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIHNjZW5lPW5ldyBUSFJFRS5TY2VuZSgpO1xyXG4gICAgICAgIHZhciBjYW1lcmE9bmV3IFRIUkVFLkNhbWVyYSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGQob2JqZWN0KXtcclxuICAgICAgICAgICAgc2NlbmUuYWRkKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUob2JqZWN0KXtcclxuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKG9iamVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHNjZW5lOnNjZW5lLFxyXG4gICAgICAgICAgICBjYW1lcmE6Y2FtZXJhLFxyXG4gICAgICAgICAgICBhZGQ6YWRkLFxyXG4gICAgICAgICAgICByZW1vdmU6cmVtb3ZlXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHZhciBjcmVhdGU9ZnVuY3Rpb24oZ2xDYW52YXMsIGRpbWVuc2lvbnMsIHNvdXJjZUNhbnZhcyl7XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJlcj1uZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7Y2FudmFzOmdsQ2FudmFzfSk7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZShkaW1lbnNpb25zLndpZHRoLCBkaW1lbnNpb25zLmhlaWdodCk7XHJcbiAgICAgICAgcmVuZGVyZXIuYXV0b0NsZWFyPWZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgcmVhbGl0eT0gbmV3IFJlYWxpdHkoc291cmNlQ2FudmFzKTtcclxuICAgICAgICB2YXIgdmlydHVhbD0gbmV3IFNjZW5lKCk7XHJcblxyXG4gICAgICAgIHZhciBsaWdodD1uZXcgVEhSRUUuU3BvdExpZ2h0KDB4ZmZmZmZmKTtcclxuICAgICAgICBsaWdodC5wb3NpdGlvbi5zZXQoMCwwLDkwMDApO1xyXG4gICAgICAgIGxpZ2h0Lmxvb2tBdChuZXcgVEhSRUUuVmVjdG9yMygwLDAsMCkpO1xyXG4gICAgICAgIHZpcnR1YWwuc2NlbmUuYWRkKGxpZ2h0KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCl7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcihyZWFsaXR5LnNjZW5lLCByZWFsaXR5LmNhbWVyYSk7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcih2aXJ0dWFsLnNjZW5lLCB2aXJ0dWFsLmNhbWVyYSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoKXtcclxuICAgICAgICAgICAgcmVhbGl0eS51cGRhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZChvYmplY3Qpe1xyXG4gICAgICAgICAgICB2aXJ0dWFsLmFkZChvYmplY3QubW9kZWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKG9iamVjdCl7XHJcbiAgICAgICAgICAgIHZpcnR1YWwucmVtb3ZlKG9iamVjdC5tb2RlbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhZGQ6IGFkZCxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgICAgICByZW5kZXI6IHJlbmRlcixcclxuICAgICAgICAgICAgZ2xDYW52YXM6IGdsQ2FudmFzXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNyZWF0ZTpjcmVhdGVcclxuICAgIH1cclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUkNhbWVyYScsIGZ1bmN0aW9uKCBBUlV0aWxzKSB7XHJcblxyXG4gICAgdmFyIHZpZGVvPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8nKTtcclxuICAgIEFSVXRpbHMuc2l6ZSh2aWRlbyk7XHJcblxyXG4gICAgdmFyIGdldE1lZGlhQ2FwdHVyZSA9IGZ1bmN0aW9uKHQsIG9uc3VjY2Vzcywgb25lcnJvcikge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKG5hdmlnYXRvci5nZXRVc2VyTWVkaWEpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbmF2aWdhdG9yLmdldFVzZXJNZWRpYSh0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKHQsIG9uc3VjY2Vzcywgb25lcnJvcik7XHJcbiAgICAgICAgfSBcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgb25TdWNjZXNzPWZ1bmN0aW9uKGNiKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc3RyZWFtKXtcclxuICAgICAgICAgICAgdmFyIHZlbmRvclVSTCA9IHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTDtcclxuICAgICAgICAgICAgdmlkZW8uc3JjID0gdmVuZG9yVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pO1xyXG4gICAgICAgICAgICB2aWRlby5wbGF5KCk7XHJcbiAgICAgICAgICAgIGNiKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIHZhciBvbkVycm9yPWZ1bmN0aW9uKGVycil7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJBbiBlcnJvciBvY2N1cmVkISBcIiArIGVycik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHZhciB3YWl0Q2FtZXJhPWZ1bmN0aW9uKGNhbGxiYWNrKXtcclxuXHJcbiAgICAgICAgZ2V0TWVkaWFDYXB0dXJlKHt2aWRlbzogdHJ1ZSxhdWRpbzogZmFsc2V9LCBvblN1Y2Nlc3MoY2FsbGJhY2spLCBvbkVycm9yKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGdldERpbWVuc2lvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aWR0aDp2aWRlby53aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0OnZpZGVvLmhlaWdodFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YXIgY29weVRvQ29udGV4dD1mdW5jdGlvbihjb250ZXh0KXtcclxuICAgICAgICBjb250ZXh0LmRyYXdJbWFnZSh2aWRlbywgMCwwKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHdhaXQ6d2FpdENhbWVyYSxcclxuICAgICAgICBjb3B5VG9Db250ZXh0OmNvcHlUb0NvbnRleHQsXHJcbiAgICAgICAgZ2V0RGltZW5zaW9uczpnZXREaW1lbnNpb25zXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJEZXRlY3RvcicsIGZ1bmN0aW9uKCkge1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBjcmVhdGUoKXtcclxuICAgICAgICByZXR1cm4ge307XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgY3JlYXRlOmNyZWF0ZVxyXG4gICAgfVxyXG4gICAgXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhci10b29sa2l0JylcclxuICAgIC5mYWN0b3J5KCdBUicsIGZ1bmN0aW9uKEFSQ2FtZXJhLCBBUkRldGVjdG9yLCBBUjNEKSB7XHJcblxyXG4gICAgdmFyIGNhbnZhcywgY29udGV4dCwgZGV0ZWN0b3IsIHZpZXc7XHJcbiAgICB2YXIgaW5pdD1mdW5jdGlvbihnbENhbnZhcyl7XHJcblxyXG4gICAgICAgIGNhbnZhcz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xyXG4gICAgICAgIHZhciBjYW1lcmFEaW1lbnNpb25zPUFSQ2FtZXJhLmdldERpbWVuc2lvbnMoKTtcclxuICAgICAgICBjYW52YXMud2lkdGggPSBjYW1lcmFEaW1lbnNpb25zLndpZHRoO1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBjYW1lcmFEaW1lbnNpb25zLmhlaWdodDtcclxuXHJcbiAgICAgICAgY29udGV4dD1jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vZGV0ZWN0b3I9QVJEZXRlY3Rvci5jcmVhdGUoY2FudmFzKTtcclxuICAgICAgICBcclxuICAgICAgICB2aWV3PUFSM0QuY3JlYXRlKGdsQ2FudmFzLCBjYW1lcmFEaW1lbnNpb25zLCBjYW52YXMpO1xyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgdmFyIHRpY2s9ZnVuY3Rpb24oKXtcclxuICAgICAgICBBUkNhbWVyYS5jb3B5VG9Db250ZXh0KGNvbnRleHQpO1xyXG4gICAgICAgIGNhbnZhcy5jaGFuZ2VkPXRydWU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmlldy51cGRhdGUoKTtcclxuICAgICAgICB2aWV3LnJlbmRlcigpO1xyXG4gICAgICAgIFxyXG4gICAgXHJcbiAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGljayk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0OmluaXQsXHJcbiAgICAgICAgdGljazp0aWNrXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJVdGlscycsIGZ1bmN0aW9uKCRpb25pY1BsYXRmb3JtKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzaXplOmZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICAgICAgICBlbGVtLndpZHRoPXdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICBlbGVtLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICBlbGVtLndpZHRoPXdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICBlbGVtLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7Il19
