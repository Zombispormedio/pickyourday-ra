var app=angular.module("ar-toolkit",["ionic"]);angular.module("ar-toolkit").run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("ar-toolkit").directive("arView",["ARUtils","ARCamera","AR",function(e,n,t){return{restrict:"A",link:function(e,r,a){var o=r[0];n.wait(function(){t.init(o),t.tick()})}}}]),angular.module("ar-toolkit").factory("AR3D",function(){var e=function(e){function n(){o.needsUpdate=!0}var t=new THREE.Camera,r=new THREE.Scene,a=new THREE.PlaneGeometry(2,2,0),o=new THREE.Texture(e),i=new THREE.MeshBasicMaterial({map:o,depthTest:!1,depthWrite:!1}),c=new THREE.Mesh(a,i);return r.add(c),{camera:t,scene:r,update:n}},n=function(){function e(e){t.add(e)}function n(e){t.remove(e)}var t=new THREE.Scene,r=new THREE.Camera;return{scene:t,camera:r,add:e,remove:n}},t=function(t,r,a){function o(){d.render(l.scene,l.camera),d.render(w.scene,w.camera)}function i(){l.update()}function c(e){w.add(e.model)}function u(e){w.remove(e.model)}var d=new THREE.WebGLRenderer({canvas:t});d.setSize(r.width,r.height),d.autoClear=!1;var l=new e(a),w=new n,f=new THREE.SpotLight(16777215);return f.position.set(0,0,9e3),f.lookAt(new THREE.Vector3(0,0,0)),w.scene.add(f),{add:c,remove:u,update:i,render:o,glCanvas:t}};return{create:t}}),angular.module("ar-toolkit").factory("ARCamera",["ARUtils",function(e){var n=document.createElement("video");e.fullPage(n);var t=function(e,n,t){var r=void 0;return navigator.getUserMedia?r=navigator.getUserMedia(e,n,t):navigator.webkitGetUserMedia&&(r=navigator.webkitGetUserMedia(e,n,t)),r},r=function(e){return function(t){var r=window.URL||window.webkitURL;n.src=r.createObjectURL(t),n.play(),e()}},a=function(e){console.log("An error occured! "+e)},o=function(e){t({video:!0,audio:!1},r(e),a)},i=function(){return{width:n.width,height:n.height}},c=function(e){e.drawImage(n,0,0)};return{wait:o,copyToContext:c,getDimensions:i}}]),angular.module("ar-toolkit").factory("ARDetector",function(){function e(){return{}}return{create:e}}),angular.module("ar-toolkit").factory("AR",["ARCamera","ARDetector","AR3D",function(e,n,t){var r,a,o,i=function(n){r=document.createElement("canvas");var i=e.getDimensions();r.width=i.width,r.height=i.height,a=r.getContext("2d"),o=t.create(n,i,r)},c=function(){e.copyToContext(a),r.changed=!0,o.update(),o.render(),window.requestAnimationFrame(c)};return{init:i,tick:c}}]),angular.module("ar-toolkit").factory("ARUtils",function(){return{fullPage:function(e){e.width=window.innerWidth,e.height=window.innerHeight}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZy9ib290LmpzIiwiY29tcG9uZW50cy9kaXJlY3RpdmVzL2FyX3ZpZXdfZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfM2RfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2NhbWVyYV9mYWN0b3J5LmpzIiwiY29tcG9uZW50cy9mYWN0b3JpZXMvYXJfZGV0ZWN0b3JfZmFjdG9yeS5qcyIsImNvbXBvbmVudHMvZmFjdG9yaWVzL2FyX2ZhY3RvcnkuanMiLCJjb21wb25lbnRzL2ZhY3Rvcmllcy9hcl91dGlsc19mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJydW4iLCIkaW9uaWNQbGF0Zm9ybSIsInJlYWR5Iiwid2luZG93IiwiY29yZG92YSIsInBsdWdpbnMiLCJLZXlib2FyZCIsImhpZGVLZXlib2FyZEFjY2Vzc29yeUJhciIsImRpc2FibGVTY3JvbGwiLCJTdGF0dXNCYXIiLCJzdHlsZURlZmF1bHQiLCJkaXJlY3RpdmUiLCJBUlV0aWxzIiwiQVJDYW1lcmEiLCJBUiIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwidEVsZW1lbnQiLCJhdHRycyIsImVsZW0iLCJ3YWl0IiwiaW5pdCIsInRpY2siLCJmYWN0b3J5IiwiUmVhbGl0eSIsInNvdXJjZUNhbnZhcyIsInVwZGF0ZSIsInRleHR1cmUiLCJuZWVkc1VwZGF0ZSIsImNhbWVyYSIsIlRIUkVFIiwiQ2FtZXJhIiwic2NlbmUiLCJTY2VuZSIsImdlb21ldHJ5IiwiUGxhbmVHZW9tZXRyeSIsIlRleHR1cmUiLCJtYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwibWFwIiwiZGVwdGhUZXN0IiwiZGVwdGhXcml0ZSIsIm1lc2giLCJNZXNoIiwiYWRkIiwib2JqZWN0IiwicmVtb3ZlIiwiY3JlYXRlIiwiZ2xDYW52YXMiLCJkaW1lbnNpb25zIiwicmVuZGVyIiwicmVuZGVyZXIiLCJyZWFsaXR5IiwidmlydHVhbCIsIm1vZGVsIiwiV2ViR0xSZW5kZXJlciIsImNhbnZhcyIsInNldFNpemUiLCJ3aWR0aCIsImhlaWdodCIsImF1dG9DbGVhciIsImxpZ2h0IiwiU3BvdExpZ2h0IiwicG9zaXRpb24iLCJzZXQiLCJsb29rQXQiLCJWZWN0b3IzIiwidmlkZW8iLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJmdWxsUGFnZSIsImdldE1lZGlhQ2FwdHVyZSIsInQiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwicmVzdWx0IiwidW5kZWZpbmVkIiwibmF2aWdhdG9yIiwiZ2V0VXNlck1lZGlhIiwid2Via2l0R2V0VXNlck1lZGlhIiwib25TdWNjZXNzIiwiY2IiLCJzdHJlYW0iLCJ2ZW5kb3JVUkwiLCJVUkwiLCJ3ZWJraXRVUkwiLCJzcmMiLCJjcmVhdGVPYmplY3RVUkwiLCJwbGF5Iiwib25FcnJvciIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ3YWl0Q2FtZXJhIiwiY2FsbGJhY2siLCJhdWRpbyIsImdldERpbWVuc2lvbnMiLCJjb3B5VG9Db250ZXh0IiwiY29udGV4dCIsImRyYXdJbWFnZSIsIkFSRGV0ZWN0b3IiLCJBUjNEIiwidmlldyIsImNhbWVyYURpbWVuc2lvbnMiLCJnZXRDb250ZXh0IiwiY2hhbmdlZCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxjQUFBLFNDQUFELFNBQUFDLE9BQUEsY0FDQUMsS0FBQSxpQkFBQSxTQUFBQyxHQUNBQSxFQUFBQyxNQUFBLFdBQ0FDLE9BQUFDLFNBQUFELE9BQUFDLFFBQUFDLFFBQUFDLFdBR0FGLFFBQUFDLFFBQUFDLFNBQUFDLDBCQUFBLEdBS0FILFFBQUFDLFFBQUFDLFNBQUFFLGVBQUEsSUFFQUwsT0FBQU0sV0FDQUEsVUFBQUMsb0JDZEFaLFFBQUFDLE9BQUEsY0FDQVksVUFBQSxVQUFBLFVBQUEsV0FBQSxLQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBRUEsT0FDQUMsU0FBQSxJQUNBQyxLQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUYsRUFBQSxFQUVBTCxHQUFBUSxLQUFBLFdBQ0FQLEVBQUFRLEtBQUFGLEdBQ0FOLEVBQUFTLGNDVkF6QixRQUFBQyxPQUFBLGNBQ0F5QixRQUFBLE9BQUEsV0FHQSxHQUFBQyxHQUFBLFNBQUFDLEdBZ0JBLFFBQUFDLEtBQ0FDLEVBQUFDLGFBQUEsRUFmQSxHQUFBQyxHQUFBLEdBQUFDLE9BQUFDLE9BQ0FDLEVBQUEsR0FBQUYsT0FBQUcsTUFFQUMsRUFBQSxHQUFBSixPQUFBSyxjQUFBLEVBQUEsRUFBQSxHQUNBUixFQUFBLEdBQUFHLE9BQUFNLFFBQUFYLEdBQ0FZLEVBQUEsR0FBQVAsT0FBQVEsbUJBQ0FDLElBQUFaLEVBQ0FhLFdBQUEsRUFDQUMsWUFBQSxJQUdBQyxFQUFBLEdBQUFaLE9BQUFhLEtBQUFULEVBQUFHLEVBT0EsT0FOQUwsR0FBQVksSUFBQUYsSUFPQWIsT0FBQUEsRUFDQUcsTUFBQUEsRUFDQU4sT0FBQUEsSUFJQU8sRUFBQSxXQUlBLFFBQUFXLEdBQUFDLEdBQ0FiLEVBQUFZLElBQUFDLEdBR0EsUUFBQUMsR0FBQUQsR0FDQWIsRUFBQWMsT0FBQUQsR0FSQSxHQUFBYixHQUFBLEdBQUFGLE9BQUFHLE1BQ0FKLEVBQUEsR0FBQUMsT0FBQUMsTUFVQSxRQUNBQyxNQUFBQSxFQUNBSCxPQUFBQSxFQUNBZSxJQUFBQSxFQUNBRSxPQUFBQSxJQU9BQyxFQUFBLFNBQUFDLEVBQUFDLEVBQUF4QixHQWNBLFFBQUF5QixLQUNBQyxFQUFBRCxPQUFBRSxFQUFBcEIsTUFBQW9CLEVBQUF2QixRQUNBc0IsRUFBQUQsT0FBQUcsRUFBQXJCLE1BQUFxQixFQUFBeEIsUUFHQSxRQUFBSCxLQUNBMEIsRUFBQTFCLFNBR0EsUUFBQWtCLEdBQUFDLEdBQ0FRLEVBQUFULElBQUFDLEVBQUFTLE9BR0EsUUFBQVIsR0FBQUQsR0FDQVEsRUFBQVAsT0FBQUQsRUFBQVMsT0ExQkEsR0FBQUgsR0FBQSxHQUFBckIsT0FBQXlCLGVBQUFDLE9BQUFSLEdBQ0FHLEdBQUFNLFFBQUFSLEVBQUFTLE1BQUFULEVBQUFVLFFBQ0FSLEVBQUFTLFdBQUEsQ0FFQSxJQUFBUixHQUFBLEdBQUE1QixHQUFBQyxHQUNBNEIsRUFBQSxHQUFBcEIsR0FFQTRCLEVBQUEsR0FBQS9CLE9BQUFnQyxVQUFBLFNBc0JBLE9BckJBRCxHQUFBRSxTQUFBQyxJQUFBLEVBQUEsRUFBQSxLQUNBSCxFQUFBSSxPQUFBLEdBQUFuQyxPQUFBb0MsUUFBQSxFQUFBLEVBQUEsSUFDQWIsRUFBQXJCLE1BQUFZLElBQUFpQixJQW9CQWpCLElBQUFBLEVBQ0FFLE9BQUFBLEVBQ0FwQixPQUFBQSxFQUNBd0IsT0FBQUEsRUFDQUYsU0FBQUEsR0FJQSxRQUNBRCxPQUFBQSxLQy9GQWxELFFBQUFDLE9BQUEsY0FDQXlCLFFBQUEsWUFBQSxVQUFBLFNBQUFaLEdBRUEsR0FBQXdELEdBQUFDLFNBQUFDLGNBQUEsUUFDQTFELEdBQUEyRCxTQUFBSCxFQUVBLElBQUFJLEdBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxHQUFBQyxHQUFBQyxNQU1BLE9BTEFDLFdBQUFDLGFBQ0FILEVBQUFFLFVBQUFDLGFBQUFOLEVBQUFDLEVBQUFDLEdBQ0FHLFVBQUFFLHFCQUNBSixFQUFBRSxVQUFBRSxtQkFBQVAsRUFBQUMsRUFBQUMsSUFFQUMsR0FHQUssRUFBQSxTQUFBQyxHQUNBLE1BQUEsVUFBQUMsR0FDQSxHQUFBQyxHQUFBakYsT0FBQWtGLEtBQUFsRixPQUFBbUYsU0FDQWxCLEdBQUFtQixJQUFBSCxFQUFBSSxnQkFBQUwsR0FDQWYsRUFBQXFCLE9BQ0FQLE1BSUFRLEVBQUEsU0FBQUMsR0FDQUMsUUFBQUMsSUFBQSxxQkFBQUYsSUFJQUcsRUFBQSxTQUFBQyxHQUVBdkIsR0FBQUosT0FBQSxFQUFBNEIsT0FBQSxHQUFBZixFQUFBYyxHQUFBTCxJQUlBTyxFQUFBLFdBQ0EsT0FDQXRDLE1BQUFTLEVBQUFULE1BQ0FDLE9BQUFRLEVBQUFSLFNBSUFzQyxFQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLFVBQUFoQyxFQUFBLEVBQUEsR0FHQSxRQUNBL0MsS0FBQXlFLEVBQ0FJLGNBQUFBLEVBQ0FELGNBQUFBLE1DbERBbkcsUUFBQUMsT0FBQSxjQUNBeUIsUUFBQSxhQUFBLFdBRUEsUUFBQXdCLEtBQ0EsU0FHQSxPQUNBQSxPQUFBQSxLQ1JBbEQsUUFBQUMsT0FBQSxjQUNBeUIsUUFBQSxNQUFBLFdBQUEsYUFBQSxPQUFBLFNBQUFYLEVBQUF3RixFQUFBQyxHQUVBLEdBQUE3QyxHQUFBMEMsRUFBQUksRUFDQWpGLEVBQUEsU0FBQTJCLEdBRUFRLEVBQUFZLFNBQUFDLGNBQUEsU0FDQSxJQUFBa0MsR0FBQTNGLEVBQUFvRixlQUNBeEMsR0FBQUUsTUFBQTZDLEVBQUE3QyxNQUNBRixFQUFBRyxPQUFBNEMsRUFBQTVDLE9BRUF1QyxFQUFBMUMsRUFBQWdELFdBQUEsTUFJQUYsRUFBQUQsRUFBQXRELE9BQUFDLEVBQUF1RCxFQUFBL0MsSUFJQWxDLEVBQUEsV0FDQVYsRUFBQXFGLGNBQUFDLEdBQ0ExQyxFQUFBaUQsU0FBQSxFQUVBSCxFQUFBNUUsU0FDQTRFLEVBQUFwRCxTQUdBaEQsT0FBQXdHLHNCQUFBcEYsR0FHQSxRQUNBRCxLQUFBQSxFQUNBQyxLQUFBQSxNQ2hDQXpCLFFBQUFDLE9BQUEsY0FDQXlCLFFBQUEsVUFBQSxXQUVBLE9BQ0ErQyxTQUFBLFNBQUFuRCxHQUNBQSxFQUFBdUMsTUFBQXhELE9BQUF5RyxXQUNBeEYsRUFBQXdDLE9BQUF6RCxPQUFBMEciLCJmaWxlIjoicGlja3lvdXJkYXkubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcD1hbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcsIFsnaW9uaWMnXSlcblxuXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbi5ydW4oZnVuY3Rpb24oJGlvbmljUGxhdGZvcm0pIHtcclxuICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgIGlmKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcclxuICAgICAgLy8gSGlkZSB0aGUgYWNjZXNzb3J5IGJhciBieSBkZWZhdWx0IChyZW1vdmUgdGhpcyB0byBzaG93IHRoZSBhY2Nlc3NvcnkgYmFyIGFib3ZlIHRoZSBrZXlib2FyZFxyXG4gICAgICAvLyBmb3IgZm9ybSBpbnB1dHMpXHJcbiAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5oaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBEb24ndCByZW1vdmUgdGhpcyBsaW5lIHVubGVzcyB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuIEl0IHN0b3BzIHRoZSB2aWV3cG9ydFxyXG4gICAgICAvLyBmcm9tIHNuYXBwaW5nIHdoZW4gdGV4dCBpbnB1dHMgYXJlIGZvY3VzZWQuIElvbmljIGhhbmRsZXMgdGhpcyBpbnRlcm5hbGx5IGZvclxyXG4gICAgICAvLyBhIG11Y2ggbmljZXIga2V5Ym9hcmQgZXhwZXJpZW5jZS5cclxuICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmRpc2FibGVTY3JvbGwodHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBpZih3aW5kb3cuU3RhdHVzQmFyKSB7XHJcbiAgICAgIFN0YXR1c0Jhci5zdHlsZURlZmF1bHQoKTtcclxuICAgIH1cclxuICB9KTtcclxuICAgIFxyXG4gICAgXHJcbn0pIiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmRpcmVjdGl2ZSgnYXJWaWV3JywgZnVuY3Rpb24oQVJVdGlscywgQVJDYW1lcmEsIEFSKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgIGxpbms6ZnVuY3Rpb24oc2NvcGUsIHRFbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgIHZhciBlbGVtPXRFbGVtZW50WzBdO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgQVJDYW1lcmEud2FpdChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgQVIuaW5pdChlbGVtKTtcclxuICAgICAgICAgICAgICAgIEFSLnRpY2soKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSM0QnLCBmdW5jdGlvbigpIHtcclxuXHJcblxyXG4gICAgdmFyIFJlYWxpdHk9ZnVuY3Rpb24oc291cmNlQ2FudmFzKXtcclxuXHJcbiAgICAgICAgdmFyIGNhbWVyYT0gbmV3IFRIUkVFLkNhbWVyYSgpO1xyXG4gICAgICAgIHZhciBzY2VuZT0gbmV3IFRIUkVFLlNjZW5lKCk7XHJcblxyXG4gICAgICAgIHZhciBnZW9tZXRyeT0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMiwyLDApO1xyXG4gICAgICAgIHZhciB0ZXh0dXJlPW5ldyBUSFJFRS5UZXh0dXJlKHNvdXJjZUNhbnZhcyk7XHJcbiAgICAgICAgdmFyIG1hdGVyaWFsPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6dGV4dHVyZSxcclxuICAgICAgICAgICAgZGVwdGhUZXN0OmZhbHNlLFxyXG4gICAgICAgICAgICBkZXB0aFdyaXRlOmZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBtZXNoPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpO1xyXG4gICAgICAgIHNjZW5lLmFkZChtZXNoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCl7XHJcbiAgICAgICAgICAgIHRleHR1cmUubmVlZHNVcGRhdGU9dHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNhbWVyYTogY2FtZXJhLFxyXG4gICAgICAgICAgICBzY2VuZTogc2NlbmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLCBcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBTY2VuZT1mdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBzY2VuZT1uZXcgVEhSRUUuU2NlbmUoKTtcclxuICAgICAgICB2YXIgY2FtZXJhPW5ldyBUSFJFRS5DYW1lcmEoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkKG9iamVjdCl7XHJcbiAgICAgICAgICAgIHNjZW5lLmFkZChvYmplY3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKG9iamVjdCl7XHJcbiAgICAgICAgICAgIHNjZW5lLnJlbW92ZShvYmplY3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBzY2VuZTpzY2VuZSxcclxuICAgICAgICAgICAgY2FtZXJhOmNhbWVyYSxcclxuICAgICAgICAgICAgYWRkOmFkZCxcclxuICAgICAgICAgICAgcmVtb3ZlOnJlbW92ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICB2YXIgY3JlYXRlPWZ1bmN0aW9uKGdsQ2FudmFzLCBkaW1lbnNpb25zLCBzb3VyY2VDYW52YXMpe1xyXG5cclxuICAgICAgICB2YXIgcmVuZGVyZXI9bmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoe2NhbnZhczpnbENhbnZhc30pO1xyXG4gICAgICAgIHJlbmRlcmVyLnNldFNpemUoZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQpO1xyXG4gICAgICAgIHJlbmRlcmVyLmF1dG9DbGVhcj1mYWxzZTtcclxuXHJcbiAgICAgICAgdmFyIHJlYWxpdHk9IG5ldyBSZWFsaXR5KHNvdXJjZUNhbnZhcyk7XHJcbiAgICAgICAgdmFyIHZpcnR1YWw9IG5ldyBTY2VuZSgpO1xyXG5cclxuICAgICAgICB2YXIgbGlnaHQ9bmV3IFRIUkVFLlNwb3RMaWdodCgweGZmZmZmZik7XHJcbiAgICAgICAgbGlnaHQucG9zaXRpb24uc2V0KDAsMCw5MDAwKTtcclxuICAgICAgICBsaWdodC5sb29rQXQobmV3IFRIUkVFLlZlY3RvcjMoMCwwLDApKTtcclxuICAgICAgICB2aXJ0dWFsLnNjZW5lLmFkZChsaWdodCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbmRlcigpe1xyXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIocmVhbGl0eS5zY2VuZSwgcmVhbGl0eS5jYW1lcmEpO1xyXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIodmlydHVhbC5zY2VuZSwgdmlydHVhbC5jYW1lcmEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCl7XHJcbiAgICAgICAgICAgIHJlYWxpdHkudXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGQob2JqZWN0KXtcclxuICAgICAgICAgICAgdmlydHVhbC5hZGQob2JqZWN0Lm1vZGVsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShvYmplY3Qpe1xyXG4gICAgICAgICAgICB2aXJ0dWFsLnJlbW92ZShvYmplY3QubW9kZWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYWRkOiBhZGQsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgcmVuZGVyOiByZW5kZXIsXHJcbiAgICAgICAgICAgIGdsQ2FudmFzOiBnbENhbnZhc1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjcmVhdGU6Y3JlYXRlXHJcbiAgICB9XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVJDYW1lcmEnLCBmdW5jdGlvbiggQVJVdGlscykge1xyXG5cclxuICAgIHZhciB2aWRlbz0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTtcclxuICAgIEFSVXRpbHMuZnVsbFBhZ2UodmlkZW8pO1xyXG5cclxuICAgIHZhciBnZXRNZWRpYUNhcHR1cmUgPSBmdW5jdGlvbih0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IG5hdmlnYXRvci5nZXRVc2VyTWVkaWEodCwgb25zdWNjZXNzLCBvbmVycm9yKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSh0LCBvbnN1Y2Nlc3MsIG9uZXJyb3IpO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIG9uU3VjY2Vzcz1mdW5jdGlvbihjYil7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSl7XHJcbiAgICAgICAgICAgIHZhciB2ZW5kb3JVUkwgPSB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkw7XHJcbiAgICAgICAgICAgIHZpZGVvLnNyYyA9IHZlbmRvclVSTC5jcmVhdGVPYmplY3RVUkwoc3RyZWFtKTtcclxuICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xyXG4gICAgICAgICAgICBjYigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICB2YXIgb25FcnJvcj1mdW5jdGlvbihlcnIpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQW4gZXJyb3Igb2NjdXJlZCEgXCIgKyBlcnIpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2YXIgd2FpdENhbWVyYT1mdW5jdGlvbihjYWxsYmFjayl7XHJcblxyXG4gICAgICAgIGdldE1lZGlhQ2FwdHVyZSh7dmlkZW86IHRydWUsYXVkaW86IGZhbHNlfSwgb25TdWNjZXNzKGNhbGxiYWNrKSwgb25FcnJvcik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHZhciBnZXREaW1lbnNpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6dmlkZW8ud2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDp2aWRlby5oZWlnaHRcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGNvcHlUb0NvbnRleHQ9ZnVuY3Rpb24oY29udGV4dCl7XHJcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UodmlkZW8sIDAsMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB3YWl0OndhaXRDYW1lcmEsXHJcbiAgICAgICAgY29weVRvQ29udGV4dDpjb3B5VG9Db250ZXh0LFxyXG4gICAgICAgIGdldERpbWVuc2lvbnM6Z2V0RGltZW5zaW9uc1xyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSRGV0ZWN0b3InLCBmdW5jdGlvbigpIHtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gY3JlYXRlKCl7XHJcbiAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNyZWF0ZTpjcmVhdGVcclxuICAgIH1cclxuICAgIFxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXItdG9vbGtpdCcpXHJcbiAgICAuZmFjdG9yeSgnQVInLCBmdW5jdGlvbihBUkNhbWVyYSwgQVJEZXRlY3RvciwgQVIzRCkge1xyXG5cclxuICAgIHZhciBjYW52YXMsIGNvbnRleHQsIGRldGVjdG9yLCB2aWV3O1xyXG4gICAgdmFyIGluaXQ9ZnVuY3Rpb24oZ2xDYW52YXMpe1xyXG5cclxuICAgICAgICBjYW52YXM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuICAgICAgICB2YXIgY2FtZXJhRGltZW5zaW9ucz1BUkNhbWVyYS5nZXREaW1lbnNpb25zKCk7XHJcbiAgICAgICAgY2FudmFzLndpZHRoID0gY2FtZXJhRGltZW5zaW9ucy53aWR0aDtcclxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gY2FtZXJhRGltZW5zaW9ucy5oZWlnaHQ7XHJcblxyXG4gICAgICAgIGNvbnRleHQ9Y2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuICAgICAgICBcclxuICAgICAgICAvL2RldGVjdG9yPUFSRGV0ZWN0b3IuY3JlYXRlKGNhbnZhcyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmlldz1BUjNELmNyZWF0ZShnbENhbnZhcywgY2FtZXJhRGltZW5zaW9ucywgY2FudmFzKTtcclxuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHZhciB0aWNrPWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgQVJDYW1lcmEuY29weVRvQ29udGV4dChjb250ZXh0KTtcclxuICAgICAgICBjYW52YXMuY2hhbmdlZD10cnVlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZpZXcudXBkYXRlKCk7XHJcbiAgICAgICAgdmlldy5yZW5kZXIoKTtcclxuICAgICAgICBcclxuICAgIFxyXG4gICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2spO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW5pdDppbml0LFxyXG4gICAgICAgIHRpY2s6dGlja1xyXG4gICAgfVxyXG5cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FyLXRvb2xraXQnKVxyXG4gICAgLmZhY3RvcnkoJ0FSVXRpbHMnLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGZ1bGxQYWdlOmZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICAgICAgICBlbGVtLndpZHRoPXdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICBlbGVtLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
